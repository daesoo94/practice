webpackJsonp([1],{"/c9u":function(e,t,i){"use strict";var n=i("OvRC"),a=i.n(n),r=i("XDXK"),s=function(e,t,i,n,a,s){this.color=t;i=void 0!==i?i:0,n=void 0!==n?n:0,a=void 0!==a?a:1,s=void 0!==s?s:1;r.a.bind(this)(e,i,n,a,s)};(s.prototype=a()(r.a.prototype)).draw=function(e,t,i,n,a){e.fillStyle=this.color,e.fillRect(t,i,n,a)},t.a=s},"1fqz":function(e,t,i){"use strict";var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),s=i.n(r),o=i("zwoO"),h=i.n(o),l=i("Pf15"),u=i.n(l),c=function(e){function t(e,i,n){s()(this,t);var r=h()(this,(t.__proto__||a()(t)).call(this,e,n));return r.name=i,r}return u()(t,e),t}(i("zTqn").a);t.a=c},AeT2:function(e,t,i){"use strict";(function(e){var n=i("C4MV"),a=i.n(n),r=i("uL5Q"),s=i("Rr+P"),o=i("/c9u"),h=i("b8n+"),l=i("tTs3"),u=i("jQdr"),c=(i.n(u),["x","y","width","height","rotation","alpha","visible","pivot","anchor","smoothing","stretch","offset","text","scale","parent","textAlign","assetPath","color","left","right","up","down","ActiveInvoke"]),p=function(e,t){c.forEach(function(i){var n="_proxied_"+i;e[n]=e[i],a()(e,i,{set:function(a){e[i]!==a&&(t.shouldReDraw=!0),e[n]=a},get:function(){return e[n]}})})},d=function(e,t,i){this.displayObjects=[],this.eventListeners={click:[]},this.clearRect=null,this.gameCanvas=e,this.canvas=document.getElementById("foreground"),this.context=this.canvas.getContext("2d"),this.renderOnQuad=i||!1,this.shouldReDraw=!0,this.renderOnQuad&&this.prepareThreeJSScene(),this.resize()};d.anchors=r.a,d.prototype.addCanvasToDom=function(){this.gameCanvas.parentNode.appendChild(this.canvas)},d.prototype.prepareThreeJSScene=function(){this.camera=new e.OrthographicCamera(-this.canvas.width/2,this.canvas.width/2,this.canvas.height/2,-this.canvas.height/2,0,30),this.scene=new e.Scene,this.texture=new e.Texture(this.canvas);var t=new e.MeshBasicMaterial({map:this.texture});t.transparent=!0;var i=new e.PlaneGeometry(this.canvas.width,this.canvas.height);this.plane=new e.Mesh(i,t),this.plane.matrixAutoUpdate=!1,this.scene.add(this.plane)},d.prototype.resize=function(){this.width=800,this.height=400,this.shouldReDraw=!0},d.prototype.draw=function(){if(this.shouldReDraw){this.clearRect||this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=this.displayObjects.length,t=0;t<e;t++)this.displayObjects[t].render(this.context);this.renderOnQuad&&(this.texture.needsUpdate=!0),this.shouldReDraw=!1}},d.prototype.render=function(e){this.draw(),this.renderOnQuad&&e.render(this.scene,this.camera),this.colorReplace&&(this.context.save(),this.context.fillStyle=this.colorReplace,this.context.globalCompositeOperation="source-atop",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore())},d.prototype.createSprite=function(e,t,i,n,a){var r=new h.a(this,e,t,i,n,a);return this.displayObjects.push(r),p(r,this),r},d.prototype.createSpriteFromSheet=function(e,t,i,n,a,r,s){var o=new h.a(this,e,n,a,r,s,t,i);return this.displayObjects.push(o),p(o,this),o},d.prototype.createRectangle=function(e,t,i,n,a){var r=new o.a(this,e,t,i,n,a);return this.displayObjects.push(r),p(r,this),r},d.prototype.createText=function(e,t,i,n,a){var r=new l.a(this,e,t,i,n,a);return this.displayObjects.push(r),p(r,this),r},d.prototype.createBitmapText=function(e,t,i,n,a,r){var o=new s.a(this,e,t,i,n,a,r);return this.displayObjects.push(o),p(o,this),o},d.prototype.addEventListener=function(e,t,i){this.eventListeners[e].push({callback:t,displayObject:i})},d.prototype.clickHandler=function(e,t){var i={x:e,y:t},n=[];this.eventListeners.click.forEach(function(e){var t=e.displayObject;if(t.shouldReceiveEvents()){var a=t.getBounds();d.isInBoundingBox(i.x,i.y,a.x,a.y,a.width,a.height)&&n.push(e.callback)}});var a=!1;return n.forEach(function(e){e(),a=!0}),a},d.prototype.windowToUISpace=function(e,t){var i=this.gameCanvas.getBoundingClientRect(),n=this.height/i.height;return{x:(e-i.left)*n,y:(t-i.top)*n}},d.prototype.moveToFront=function(e){var t=this.displayObjects.indexOf(e);t>-1&&this.displayObjects.splice(t,1),this.displayObjects.push(e)},d.isInBoundingBox=function(e,t,i,n,a,r){return e>=i&&e<=i+a&&t>=n&&t<=n+r},t.a=d}).call(t,i("Ml+6"))},DwfQ:function(e,t,i){"use strict";(function(e){var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),s=i.n(r),o=i("wxAW"),h=i.n(o),l=i("zwoO"),u=i.n(l),c=i("Pf15"),p=i.n(c),d=function(t){function i(e,t){s()(this,i);var n=u()(this,(i.__proto__||a()(i)).call(this,e,t));return n.load(),n}return p()(i,t),h()(i,[{key:"load",value:function(){var t=new e.BoxBufferGeometry(8,8,8),i=new e.MeshLambertMaterial({color:16777215}),n=new e.Mesh(t,i);t.computeBoundingBox(),this.mesh=n,this.offset={x:0,y:-t.boundingBox.min.y,z:0},this.isLoaded=!0}},{key:"attachPointLight",value:function(t,i,n){var a=new e.PointLight(t,i,n);a.position.set(0,10,0),a.castShadow=!0,this.mesh.add(a)}}]),i}(i("m3jU").a);t.a=d}).call(t,i("Ml+6"))},GoZD:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),s=i.n(r);
/**
 * A* (A-Star) algorithm for a path finder
 * @author  Andrea Giammarchi
 * @license Mit Style License
 */
function o(e,t,i,n,a,r,s,o,h,l,u,c,p){return e&&(i&&!h[a][s]&&(c[p++]={x:s,y:a}),n&&!h[a][o]&&(c[p++]={x:o,y:a})),t&&(i&&!h[r][s]&&(c[p++]={x:s,y:r}),n&&!h[r][o]&&(c[p++]={x:o,y:r})),c}function h(e,t,i,n,a,r,s,o,h,l,u,c,p){return e=a>-1,t=r<l,n=o>-1,s<u&&(e&&!h[a][s]&&(c[p++]={x:s,y:a}),t&&!h[r][s]&&(c[p++]={x:s,y:r})),n&&(e&&!h[a][o]&&(c[p++]={x:o,y:a}),t&&!h[r][o]&&(c[p++]={x:o,y:r})),c}function l(e,t,i,n,a,r,s,o,h,l,u,c,p){return c}function u(e,t,i,n,a,r){var s=i-1,o=i+1,h=t+1,l=t-1,u=s>-1&&!n[s][t],c=o<a&&!n[o][t],p=h<r&&!n[i][h],d=l>-1&&!n[i][l],f=[],v=0;return u&&(f[v++]={x:t,y:s}),p&&(f[v++]={x:h,y:i}),c&&(f[v++]={x:t,y:o}),d&&(f[v++]={x:l,y:i}),e(u,c,p,d,s,o,h,l,n,a,r,f,v)}function c(e,t,i,n){return n(i(e.x-t.x),i(e.y-t.y))}function p(e,t,i,n){var a=e.x-t.x,r=e.y-t.y;return n(a*a+r*r)}function d(e,t,i,n){return i(e.x-t.x)+i(e.y-t.y)}var f=function(e,t,i,n){var a,r,s,f,v,m,g,y,w,x=e[0].length,M=e.length,S=x*M,T=Math.abs,b=Math.max,_={},E=[],k=[{x:t[0],y:t[1],f:0,g:0,v:t[0]+t[1]*x}],A=1;switch(i={x:i[0],y:i[1],v:i[0]+i[1]*x},n){case"Diagonal":s=o;case"DiagonalFree":r=c;break;case"Euclidean":s=o;case"EuclideanFree":b=Math.sqrt,r=p;break;default:r=d,s=l}s||(s=h);do{for(m=S,g=0,f=0;f<A;++f)(n=k[f].f)<m&&(m=n,g=f);if((y=k.splice(g,1)[0]).v!=i.v)for(--A,f=0,v=(w=u(s,y.x,y.y,e,M,x)).length;f<v;++f)(a=w[f]).p=y,a.f=a.g=0,a.v=a.x+a.y*x,a.v in _||(a.f=(a.g=y.g+r(a,y,T,b))+r(a,i,T,b),k[A++]=a,_[a.v]=1);else{f=A=0;do{E[f++]=[y.x,y.y]}while(y=y.p);E.reverse()}}while(A);return E},v=function(){function e(t,i){a()(this,e),this.width=t,this.height=i,this.grid=null,this.ignored=[],this.initBlankGrid()}return s()(e,[{key:"initBlankGrid",value:function(){this.blankGrid=[];for(var e=0;e<this.height;e+=1){this.blankGrid[e]=[];for(var t=0;t<this.width;t+=1)this.blankGrid[e][t]=0}}},{key:"findPath",value:function(e,t,i,n,a){var r=[t.gridX,t.gridY],s=[i,n];this.grid=e;var o=f(this.grid,r,s);return 0===o.length&&!0===a&&(o=this.findIncompletePath_(r,s)),o}},{key:"findIncompletePath_",value:function(e,t){for(var i,n=void 0,a=void 0,r=[],s=(i=f(this.blankGrid,e,t)).length-1;s>0;s-=1)if(n=i[s][0],a=i[s][1],0===this.grid[a][n]){r=f(this.grid,e,[n,a]);break}return r}},{key:"ignoreEntity",value:function(e){e&&this.ignored.push(e)}},{key:"clearIgnoreList",value:function(){this.applyIgnoreList_(!1),this.ignored=[]}}]),e}();t.a=v},ITPp:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),s=i.n(r),o=i("7t+N"),h=i.n(o),l=i("rdLu"),u=(i.n(l),function(e){return e%1==0}),c=function(){function e(t){a()(this,e),this.loadMap()}return s()(e,[{key:"loadMap",value:function(){var e=this;h.a.get("static/maps.json",function(t){e._initMap(t),e._generateCollisionGrid(),e.isLoaded=!0},"json")}},{key:"_initMap",value:function(e){this.width=e.width,this.height=e.height,this.data=e.data,this.tilesize=e.tilesize,this.collisions=e.collisions,this.props=e.props}},{key:"_generateCollisionGrid",value:function(){var e=this;this.grid=[];for(var t=0;t<this.height;t++){this.grid[t]=[];for(var i=0;i<this.width;i++)this.grid[t][i]=0}l.each(this.collisions,function(t){var i=e.tileIndexToGridPosition(t+1);e.grid[i.y][i.x]=1})}},{key:"isColliding",value:function(e,t){return!(this.isOutOfBounds(e,t)||!this.grid)&&1===this.grid[t][e]}},{key:"isOutOfBounds",value:function(e,t){return u(e)&&u(t)&&(e<0||e>=this.width||t<0||t>=this.height)}},{key:"tileIndexToGridPosition",value:function(e){return{x:(e-=1)%this.width,y:Math.floor(e/this.width)}}}]),e}();t.a=c},"N9/5":function(e,t,i){"use strict";(function(e){var n=i("fZjL"),a=i.n(n),r=i("pFYg"),s=i.n(r),o=i("OvRC"),h=i.n(o),l=i("//Fk"),u=i.n(l),c=i("Zrlr"),p=i.n(c),d=i("wxAW"),f=i.n(d),v=function(){function t(i){p()(this,t),this.manager=void 0!==i?i:e.DefaultLoadingManager,this.dracoLoader=null,this.crossOrigin="anonymous"}return f()(t,[{key:"load",value:function(t,i,n,a){var r,s=this;r=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),s.manager.itemStart(t);var o=function(e){a?a(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},h=new e.FileLoader(s.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t,function(e){try{s.parse(e,r,function(e){i(e),s.manager.itemEnd(t)},o)}catch(e){o(e)}},n,o)}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"parse",value:function(t,i,n,a){var r,s={};if("string"==typeof t)r=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===M){try{s[g.KHR_BINARY_GLTF]=new function(t){this.name=g.KHR_BINARY_GLTF,this.content=null,this.body=null;var i=new DataView(t,0,S);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==M)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");var n=new DataView(t,S),a=0;for(;a<n.byteLength;){var r=n.getUint32(a,!0);a+=4;var s=n.getUint32(a,!0);if(a+=4,s===T.JSON){var o=new Uint8Array(t,S+a,r);this.content=e.LoaderUtils.decodeText(o)}else if(s===T.BIN){var h=S+a;this.body=t.slice(h,h+r)}a+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(t)}catch(e){return void(a&&a(e))}r=s[g.KHR_BINARY_GLTF].content}else r=e.LoaderUtils.decodeText(new Uint8Array(t));var o=JSON.parse(r);if(void 0===o.asset||o.asset.version[0]<2)a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(o.extensionsUsed)for(var h=0;h<o.extensionsUsed.length;++h){var l=o.extensionsUsed[h],u=o.extensionsRequired||[];switch(l){case g.KHR_LIGHTS_PUNCTUAL:s[l]=new w(o);break;case g.KHR_MATERIALS_UNLIT:s[l]=new x(o);break;case g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[l]=new E(o);break;case g.KHR_DRACO_MESH_COMPRESSION:s[l]=new b(o,this.dracoLoader);break;case g.MSFT_TEXTURE_DDS:s[g.MSFT_TEXTURE_DDS]=new y;break;case g.KHR_TEXTURE_TRANSFORM:s[g.KHR_TEXTURE_TRANSFORM]=new _(o);break;default:u.indexOf(l)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}var c=new ee(o,s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});c.parse(function(e,t,i,a,r){var o={scene:e,scenes:t,cameras:i,animations:a,asset:r.asset,parser:c,userData:{}};Z(s,o,r),n(o)},a)}}}]),t}();t.a=v;var m=function(){function e(){p()(this,e),this.objects={}}return f()(e,[{key:"get",value:function(e){return this.objects[e]}},{key:"add",value:function(e,t){this.objects[e]=t}},{key:"remove",value:function(e){delete this.objects[e]}},{key:"removeAll",value:function(){this.objects={}}}]),e}(),g={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function y(){if(!e.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=g.MSFT_TEXTURE_DDS,this.ddsLoader=new e.DDSLoader}function w(e){this.name=g.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[g.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function x(e){this.name=g.KHR_MATERIALS_UNLIT}w.prototype.loadLight=function(t){var i,n=this.lightDefs[t],a=new e.Color(16777215);void 0!==n.color&&a.fromArray(n.color);var r=void 0!==n.range?n.range:0;switch(n.type){case"directional":(i=new e.DirectionalLight(a)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new e.PointLight(a)).distance=r;break;case"spot":(i=new e.SpotLight(a)).distance=r,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,i.angle=n.spot.outerConeAngle,i.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==n.intensity&&(i.intensity=n.intensity),i.name=n.name||"light_"+t,u.a.resolve(i)},x.prototype.getMaterialType=function(t){return e.MeshBasicMaterial},x.prototype.extendParams=function(t,i,n){var a=[];t.color=new e.Color(1,1,1),t.opacity=1;var r=i.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var s=r.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}void 0!==r.baseColorTexture&&a.push(n.assignTexture(t,"map",r.baseColorTexture))}return u.a.all(a)};var M="glTF",S=12,T={JSON:1313821514,BIN:5130562};function b(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=g.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,e.DRACOLoader.getDecoderModule()}function _(e){this.name=g.KHR_TEXTURE_TRANSFORM}function E(){return{name:g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return e.ShaderMaterial},extendParams:function(t,i,n){var a=i.extensions[this.name],r=e.ShaderLib.standard,s=e.UniformsUtils.clone(r.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),h=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),p=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),d=r.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",h).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",p);delete s.roughness,delete s.metalness,delete s.roughnessMap,delete s.metalnessMap,s.specular={value:(new e.Color).setHex(1118481)},s.glossiness={value:.5},s.specularMap={value:null},s.glossinessMap={value:null},t.vertexShader=r.vertexShader,t.fragmentShader=d,t.uniforms=s,t.defines={STANDARD:""},t.color=new e.Color(1,1,1),t.opacity=1;var f=[];if(Array.isArray(a.diffuseFactor)){var v=a.diffuseFactor;t.color.fromArray(v),t.opacity=v[3]}if(void 0!==a.diffuseTexture&&f.push(n.assignTexture(t,"map",a.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(a.specularFactor)&&t.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var m=a.specularGlossinessTexture;f.push(n.assignTexture(t,"glossinessMap",m)),f.push(n.assignTexture(t,"specularMap",m))}return u.a.all(f)},createMaterial:function(t){var i=new e.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return i.isGLTFSpecularGlossinessMaterial=!0,i.color=t.color,i.map=void 0===t.map?null:t.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=void 0===t.aoMap?null:t.aoMap,i.aoMapIntensity=1,i.emissive=t.emissive,i.emissiveIntensity=1,i.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,i.bumpMap=void 0===t.bumpMap?null:t.bumpMap,i.bumpScale=1,i.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(i.normalScale=t.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=void 0===t.specularMap?null:t.specularMap,i.specular=t.specular,i.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,i.glossiness=t.glossiness,i.alphaMap=null,i.envMap=void 0===t.envMap?null:t.envMap,i.envMapIntensity=1,i.refractionRatio=.98,i.extensions.derivatives=!0,i},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,n=0,a=i.length;n<a;n++)t[i[n]]=e[i[n]];return t},refreshUniforms:function(e,t,i,n,a,r){if(!0===a.isGLTFSpecularGlossinessMaterial){var s,o=a.uniforms,h=a.defines;o.opacity.value=a.opacity,o.diffuse.value.copy(a.color),o.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),o.map.value=a.map,o.specularMap.value=a.specularMap,o.alphaMap.value=a.alphaMap,o.lightMap.value=a.lightMap,o.lightMapIntensity.value=a.lightMapIntensity,o.aoMap.value=a.aoMap,o.aoMapIntensity.value=a.aoMapIntensity,a.map?s=a.map:a.specularMap?s=a.specularMap:a.displacementMap?s=a.displacementMap:a.normalMap?s=a.normalMap:a.bumpMap?s=a.bumpMap:a.glossinessMap?s=a.glossinessMap:a.alphaMap?s=a.alphaMap:a.emissiveMap&&(s=a.emissiveMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),o.uvTransform.value.copy(s.matrix)),a.envMap&&(o.envMap.value=a.envMap,o.envMapIntensity.value=a.envMapIntensity,o.flipEnvMap.value=a.envMap.isCubeTexture?-1:1,o.reflectivity.value=a.reflectivity,o.refractionRatio.value=a.refractionRatio,o.maxMipLevel.value=e.properties.get(a.envMap).__maxMipLevel),o.specular.value.copy(a.specular),o.glossiness.value=a.glossiness,o.glossinessMap.value=a.glossinessMap,o.emissiveMap.value=a.emissiveMap,o.bumpMap.value=a.bumpMap,o.normalMap.value=a.normalMap,o.displacementMap.value=a.displacementMap,o.displacementScale.value=a.displacementScale,o.displacementBias.value=a.displacementBias,null!==o.glossinessMap.value&&void 0===h.USE_GLOSSINESSMAP&&(h.USE_GLOSSINESSMAP="",h.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==h.USE_GLOSSINESSMAP&&(delete h.USE_GLOSSINESSMAP,delete h.USE_ROUGHNESSMAP)}}}}function k(t,i,n,a){e.Interpolant.call(this,t,i,n,a)}b.prototype.decodePrimitive=function(e,t){var i=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,s={},o={},h={};for(var l in r)l in U&&(s[U[l]]=r[l]);for(l in e.attributes)if(void 0!==U[l]&&void 0!==r[l]){var c=i.accessors[e.attributes[l]],p=O[c.componentType];h[U[l]]=p,o[U[l]]=!0===c.normalized}return t.getDependency("bufferView",a).then(function(e){return new u.a(function(t){n.decodeDracoFile(e,function(e){for(var i in e.attributes){var n=e.attributes[i],a=o[i];void 0!==a&&(n.normalized=a)}t(e)},s,h)})})},_.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},k.prototype=h()(e.Interpolant.prototype),k.prototype.constructor=k,k.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,a=e*n*3+n,r=0;r!==n;r++)t[r]=i[a+r];return t},k.prototype.beforeStart_=k.prototype.copySampleValue_,k.prototype.afterEnd_=k.prototype.copySampleValue_,k.prototype.interpolate_=function(e,t,i,n){for(var a=this.resultBuffer,r=this.sampleValues,s=this.valueSize,o=2*s,h=3*s,l=n-t,u=(i-t)/l,c=u*u,p=c*u,d=e*h,f=d-h,v=-2*p+3*c,m=p-c,g=1-v,y=m-c+u,w=0;w!==s;w++){var x=r[f+w+s],M=r[f+w+o]*l,S=r[d+w+s],T=r[d+w]*l;a[w]=g*x+y*M+v*S+m*T}return a};var A=0,R=1,L=2,I=3,D=4,P=5,F=6,O=(Number,e.Matrix3,e.Matrix4,e.Vector2,e.Vector3,e.Vector4,e.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),G={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipMapNearestFilter,9985:e.LinearMipMapNearestFilter,9986:e.NearestMipMapLinearFilter,9987:e.LinearMipMapLinearFilter},C={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},B=(e.BackSide,e.FrontSide,e.NeverDepth,e.LessDepth,e.EqualDepth,e.LessEqualDepth,e.GreaterEqualDepth,e.NotEqualDepth,e.GreaterEqualDepth,e.AlwaysDepth,e.AddEquation,e.SubtractEquation,e.ReverseSubtractEquation,e.ZeroFactor,e.OneFactor,e.SrcColorFactor,e.OneMinusSrcColorFactor,e.SrcAlphaFactor,e.OneMinusSrcAlphaFactor,e.DstAlphaFactor,e.OneMinusDstAlphaFactor,e.DstColorFactor,e.OneMinusDstColorFactor,e.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),U={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},N={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:e.InterpolateSmooth,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},j="OPAQUE",V="MASK",z="BLEND",K={"image/png":e.RGBAFormat,"image/jpeg":e.RGBFormat};function X(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function Z(e,t,i){for(var n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function Y(e,t){void 0!==t.extras&&("object"===s()(t.extras)?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function W(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var a=t.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(i=0,n=a.length;i<n;i++)e.morphTargetDictionary[a[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function q(e,t){if(a()(e).length!==a()(t).length)return!1;for(var i in e)if(e[i]!==t[i])return!1;return!0}function Q(e){var t=e.extensions&&e.extensions[g.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+J(t.attributes):e.indices+":"+J(e.attributes)+":"+e.mode}function J(e){for(var t="",i=a()(e).sort(),n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function $(t){if(t.isInterleavedBufferAttribute){for(var i=t.count,n=t.itemSize,a=t.array.slice(0,i*n),r=0,s=0;r<i;++r)a[s++]=t.getX(r),n>=2&&(a[s++]=t.getY(r)),n>=3&&(a[s++]=t.getZ(r)),n>=4&&(a[s++]=t.getW(r));return new e.BufferAttribute(a,n,t.normalized)}return t.clone()}function ee(t,i,n){this.json=t||{},this.extensions=i||{},this.options=n||{},this.cache=new m,this.primitiveCache={},this.multiplePrimitivesCache={},this.multiPassGeometryCache={},this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function te(e,t,i){var n=t.attributes,a=[];function r(t,n){return i.getDependency("accessor",t).then(function(t){e.addAttribute(n,t)})}for(var s in n){var o=U[s];o&&(o in e.attributes||a.push(r(n[s],o)))}if(void 0!==t.indices&&!e.index){var h=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});a.push(h)}return Y(e,t),u.a.all(a).then(function(){return void 0!==t.targets?function(e,t,i){for(var n=!1,a=!1,r=0,s=t.length;r<s&&(void 0!==(l=t[r]).POSITION&&(n=!0),void 0!==l.NORMAL&&(a=!0),!n||!a);r++);if(!n&&!a)return u.a.resolve(e);var o=[],h=[];for(r=0,s=t.length;r<s;r++){var l=t[r];if(n){var c=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION).then(function(e){return $(e)}):e.attributes.position;o.push(c)}a&&(c=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL).then(function(e){return $(e)}):e.attributes.normal,h.push(c))}return u.a.all([u.a.all(o),u.a.all(h)]).then(function(i){for(var r=i[0],s=i[1],o=0,h=t.length;o<h;o++){var l=t[o],u="morphTarget"+o;if(n&&void 0!==l.POSITION){var c=r[o];c.name=u;for(var p=e.attributes.position,d=0,f=c.count;d<f;d++)c.setXYZ(d,c.getX(d)+p.getX(d),c.getY(d)+p.getY(d),c.getZ(d)+p.getZ(d))}if(a&&void 0!==l.NORMAL){var v=s[o];v.name=u;var m=e.attributes.normal;for(d=0,f=v.count;d<f;d++)v.setXYZ(d,v.getX(d)+m.getX(d),v.getY(d)+m.getY(d),v.getZ(d)+m.getZ(d))}}return n&&(e.morphAttributes.position=r),a&&(e.morphAttributes.normal=s),e})}(e,t.targets,i):e})}ee.prototype.parse=function(e,t){var i=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var n=t.scenes||[],a=n[i.scene||0],r=t.animations||[],s=t.cameras||[];e(a,n,s,r,i)}).catch(t)},ee.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],n={},a={},r=0,s=t.length;r<s;r++)for(var o=t[r].joints,h=0,l=o.length;h<l;h++)e[o[h]].isBone=!0;for(var u=0,c=e.length;u<c;u++){var p=e[u];void 0!==p.mesh&&(void 0===n[p.mesh]&&(n[p.mesh]=a[p.mesh]=0),n[p.mesh]++,void 0!==p.skin&&(i[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=a},ee.prototype.getDependency=function(e,t){var i=e+":"+t,n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this.loadMesh(t);break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this.loadBufferView(t);break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this.loadMaterial(t);break;case"texture":n=this.loadTexture(t);break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;case"light":n=this.extensions[g.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n},ee.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=u.a.all(n.map(function(t,n){return i.getDependency(e,n)})),this.cache.add(e,t)}return t},ee.prototype.getMultiDependencies=function(e){for(var t={},i=[],n=0,a=e.length;n<a;n++){var r=e[n],s=this.getDependencies(r);s=s.then(function(e,i){t[e]=i}.bind(this,r+("mesh"===r?"es":"s"))),i.push(s)}return u.a.all(i).then(function(){return t})},ee.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return u.a.resolve(this.extensions[g.KHR_BINARY_GLTF].body);var n=this.options;return new u.a(function(e,a){i.load(X(t.uri,n.path),e,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},ee.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)})},ee.prototype.loadAccessor=function(t){var i=this,n=this.json,a=this.json.accessors[t];if(void 0===a.bufferView&&void 0===a.sparse)return u.a.resolve(null);var r=[];return void 0!==a.bufferView?r.push(this.getDependency("bufferView",a.bufferView)):r.push(null),void 0!==a.sparse&&(r.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",a.sparse.values.bufferView))),u.a.all(r).then(function(t){var r,s,o=t[0],h=B[a.type],l=O[a.componentType],u=l.BYTES_PER_ELEMENT,c=u*h,p=a.byteOffset||0,d=void 0!==a.bufferView?n.bufferViews[a.bufferView].byteStride:void 0,f=!0===a.normalized;if(d&&d!==c){var v="InterleavedBuffer:"+a.bufferView+":"+a.componentType,m=i.cache.get(v);m||(r=new l(o),m=new e.InterleavedBuffer(r,d/u),i.cache.add(v,m)),s=new e.InterleavedBufferAttribute(m,h,p/u,f)}else r=null===o?new l(a.count*h):new l(o,p,a.count*h),s=new e.BufferAttribute(r,h,f);if(void 0!==a.sparse){var g=B.SCALAR,y=O[a.sparse.indices.componentType],w=a.sparse.indices.byteOffset||0,x=a.sparse.values.byteOffset||0,M=new y(t[1],w,a.sparse.count*g),S=new l(t[2],x,a.sparse.count*h);null!==o&&s.setArray(s.array.slice());for(var T=0,b=M.length;T<b;T++){var _=M[T];if(s.setX(_,S[T*h]),h>=2&&s.setY(_,S[T*h+1]),h>=3&&s.setZ(_,S[T*h+2]),h>=4&&s.setW(_,S[T*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s})},ee.prototype.loadTexture=function(t){var i,n=this,a=this.json,r=this.options,s=this.textureLoader,o=window.URL||window.webkitURL,h=a.textures[t],l=h.extensions||{},c=(i=l[g.MSFT_TEXTURE_DDS]?a.images[l[g.MSFT_TEXTURE_DDS].source]:a.images[h.source]).uri,p=!1;return void 0!==i.bufferView&&(c=n.getDependency("bufferView",i.bufferView).then(function(e){p=!0;var t=new Blob([e],{type:i.mimeType});return c=o.createObjectURL(t)})),u.a.resolve(c).then(function(t){var i=e.Loader.Handlers.get(t);return i||(i=l[g.MSFT_TEXTURE_DDS]?n.extensions[g.MSFT_TEXTURE_DDS].ddsLoader:s),new u.a(function(e,n){i.load(X(t,r.path),e,void 0,n)})}).then(function(t){!0===p&&o.revokeObjectURL(c),t.flipY=!1,void 0!==h.name&&(t.name=h.name),i.mimeType in K&&(t.format=K[i.mimeType]);var n=(a.samplers||{})[h.sampler]||{};return t.magFilter=G[n.magFilter]||e.LinearFilter,t.minFilter=G[n.minFilter]||e.LinearMipMapLinearFilter,t.wrapS=C[n.wrapS]||e.RepeatWrapping,t.wrapT=C[n.wrapT]||e.RepeatWrapping,t})},ee.prototype.assignTexture=function(t,i,n){var a=this;return this.getDependency("texture",n.index).then(function(r){switch(i){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":r.format=e.RGBFormat}if(a.extensions[g.KHR_TEXTURE_TRANSFORM]){var s=void 0!==n.extensions?n.extensions[g.KHR_TEXTURE_TRANSFORM]:void 0;s&&(r=a.extensions[g.KHR_TEXTURE_TRANSFORM].extendTexture(r,s))}t[i]=r})},ee.prototype.loadMaterial=function(t){var i,n=this.json,a=this.extensions,r=n.materials[t],s={},o=r.extensions||{},h=[];if(o[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=a[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=l.getMaterialType(r),h.push(l.extendParams(s,r,this))}else if(o[g.KHR_MATERIALS_UNLIT]){var c=a[g.KHR_MATERIALS_UNLIT];i=c.getMaterialType(r),h.push(c.extendParams(s,r,this))}else{i=e.MeshStandardMaterial;var p=r.pbrMetallicRoughness||{};if(s.color=new e.Color(1,1,1),s.opacity=1,Array.isArray(p.baseColorFactor)){var d=p.baseColorFactor;s.color.fromArray(d),s.opacity=d[3]}void 0!==p.baseColorTexture&&h.push(this.assignTexture(s,"map",p.baseColorTexture)),s.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,s.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(h.push(this.assignTexture(s,"metalnessMap",p.metallicRoughnessTexture)),h.push(this.assignTexture(s,"roughnessMap",p.metallicRoughnessTexture)))}!0===r.doubleSided&&(s.side=e.DoubleSide);var f=r.alphaMode||j;return f===z?s.transparent=!0:(s.transparent=!1,f===V&&(s.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&i!==e.MeshBasicMaterial&&(h.push(this.assignTexture(s,"normalMap",r.normalTexture)),s.normalScale=new e.Vector2(1,1),void 0!==r.normalTexture.scale&&s.normalScale.set(r.normalTexture.scale,r.normalTexture.scale)),void 0!==r.occlusionTexture&&i!==e.MeshBasicMaterial&&(h.push(this.assignTexture(s,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(s.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&i!==e.MeshBasicMaterial&&(s.emissive=(new e.Color).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&i!==e.MeshBasicMaterial&&h.push(this.assignTexture(s,"emissiveMap",r.emissiveTexture)),u.a.all(h).then(function(){var t;return t=i===e.ShaderMaterial?a[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new i(s),void 0!==r.name&&(t.name=r.name),t.map&&(t.map.encoding=e.sRGBEncoding),t.emissiveMap&&(t.emissiveMap.encoding=e.sRGBEncoding),t.specularMap&&(t.specularMap.encoding=e.sRGBEncoding),Y(t,r),r.extensions&&Z(a,t,r),t})},ee.prototype.loadGeometries=function(t){var i,n=this,a=this.extensions,r=this.primitiveCache,s=function(e){if(e.length<2)return!1;var t=e[0],i=t.targets||[];if(void 0===t.indices)return!1;for(var n=1,a=e.length;n<a;n++){var r=e[n];if(t.mode!==r.mode)return!1;if(void 0===r.indices)return!1;if(r.extensions&&r.extensions[g.KHR_DRACO_MESH_COMPRESSION])return!1;if(!q(t.attributes,r.attributes))return!1;var s=r.targets||[];if(i.length!==s.length)return!1;for(var o=0,h=i.length;o<h;o++)if(!q(i[o],s[o]))return!1}return!0}(t);function o(e){return a[g.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then(function(t){return te(t,e,n)})}s&&(i=t,t=[t[0]]);for(var h=[],l=0,c=t.length;l<c;l++){var p,d=t[l],f=Q(d),v=r[f];if(v)h.push(v.promise);else p=d.extensions&&d.extensions[g.KHR_DRACO_MESH_COMPRESSION]?o(d):te(new e.BufferGeometry,d,n),r[f]={primitive:d,promise:p},h.push(p)}return u.a.all(h).then(function(a){if(s){var r=a[0],o=n.multiPassGeometryCache,h=function(e,t){for(var i=e.uuid,n=0,a=t.length;n<a;n++)i+=n+Q(t[n]);return i}(r,i);if(null!==(v=o[h]))return[v.geometry];var l=new e.BufferGeometry;for(var c in l.name=r.name,l.userData=r.userData,r.attributes)l.addAttribute(c,r.attributes[c]);for(var c in r.morphAttributes)l.morphAttributes[c]=r.morphAttributes[c];for(var p=[],d=0,f=i.length;d<f;d++)p.push(n.getDependency("accessor",i[d].indices));return u.a.all(p).then(function(e){for(var t=[],n=0,a=0,s=i.length;a<s;a++){for(var u=e[a],c=0,p=u.count;c<p;c++)t.push(u.array[c]);l.addGroup(n,u.count,a),n+=u.count}return l.setIndex(t),o[h]={geometry:l,baseGeometry:r,primitives:i},[l]})}if(a.length>1&&void 0!==e.BufferGeometryUtils){for(d=1,f=t.length;d<f;d++)if(t[0].mode!==t[d].mode)return a;var v;o=n.multiplePrimitivesCache,h=function(e){for(var t="",i=0,n=e.length;i<n;i++)t+=":"+e[i].uuid;return t}(a);if(v=o[h]){if(null!==v.geometry)return[v.geometry]}else{l=e.BufferGeometryUtils.mergeBufferGeometries(a,!0);if(o[h]={geometry:l,baseGeometries:a},null!==l)return[l]}}return a})},ee.prototype.loadMesh=function(t){for(var i=this,n=this.json,r=this.extensions,s=n.meshes[t],o=s.primitives,h=[],l=0,c=o.length;l<c;l++){var p=void 0===o[l].material?new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide}):this.getDependency("material",o[l].material);h.push(p)}return u.a.all(h).then(function(n){return i.loadGeometries(o).then(function(h){for(var l=1===h.length&&h[0].groups.length>0,u=[],c=0,p=h.length;c<p;c++){var d,f=h[c],v=o[c],m=l?n:n[c];if(v.mode===D||v.mode===P||v.mode===F||void 0===v.mode)!0===(d=!0===s.isSkinnedMesh?new e.SkinnedMesh(f,m):new e.Mesh(f,m)).isSkinnedMesh&&d.normalizeSkinWeights(),v.mode===P?d.drawMode=e.TriangleStripDrawMode:v.mode===F&&(d.drawMode=e.TriangleFanDrawMode);else if(v.mode===R)d=new e.LineSegments(f,m);else if(v.mode===I)d=new e.Line(f,m);else if(v.mode===L)d=new e.LineLoop(f,m);else{if(v.mode!==A)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);d=new e.Points(f,m)}a()(d.geometry.morphAttributes).length>0&&W(d,s),d.name=s.name||"mesh_"+t,h.length>1&&(d.name+="_"+c),Y(d,s),u.push(d);for(var y=l?d.material:[d.material],w=void 0!==f.attributes.tangent,x=void 0!==f.attributes.color,M=void 0===f.attributes.normal,S=!0===d.isSkinnedMesh,T=a()(f.morphAttributes).length>0,b=T&&void 0!==f.morphAttributes.normal,_=0,E=y.length;_<E;_++){m=y[_];if(d.isPoints){var k="PointsMaterial:"+m.uuid,O=i.cache.get(k);O||(O=new e.PointsMaterial,e.Material.prototype.copy.call(O,m),O.color.copy(m.color),O.map=m.map,O.lights=!1,i.cache.add(k,O)),m=O}else if(d.isLine){k="LineBasicMaterial:"+m.uuid;var G=i.cache.get(k);G||(G=new e.LineBasicMaterial,e.Material.prototype.copy.call(G,m),G.color.copy(m.color),G.lights=!1,i.cache.add(k,G)),m=G}if(w||x||M||S||T){k="ClonedMaterial:"+m.uuid+":";m.isGLTFSpecularGlossinessMaterial&&(k+="specular-glossiness:"),S&&(k+="skinning:"),w&&(k+="vertex-tangents:"),x&&(k+="vertex-colors:"),M&&(k+="flat-shading:"),T&&(k+="morph-targets:"),b&&(k+="morph-normals:");var C=i.cache.get(k);C||(C=m.isGLTFSpecularGlossinessMaterial?r[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(m):m.clone(),S&&(C.skinning=!0),w&&(C.vertexTangents=!0),x&&(C.vertexColors=e.VertexColors),M&&(C.flatShading=!0),T&&(C.morphTargets=!0),b&&(C.morphNormals=!0),i.cache.add(k,C)),m=C}y[_]=m,m.aoMap&&void 0===f.attributes.uv2&&void 0!==f.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),f.addAttribute("uv2",new e.BufferAttribute(f.attributes.uv.array,2))),m.isGLTFSpecularGlossinessMaterial&&(d.onBeforeRender=r[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}d.material=l?y:y[0]}if(1===u.length)return u[0];var B=new e.Group;for(c=0,p=u.length;c<p;c++)B.add(u[c]);return B})})},ee.prototype.loadCamera=function(t){var i,n=this.json.cameras[t],a=n[n.type];if(a)return"perspective"===n.type?i=new e.PerspectiveCamera(e.Math.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===n.type&&(i=new e.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar)),void 0!==n.name&&(i.name=n.name),Y(i,n),u.a.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")},ee.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?u.a.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})},ee.prototype.loadAnimation=function(t){for(var i=this.json.animations[t],n=[],a=[],r=[],s=[],o=[],h=0,l=i.channels.length;h<l;h++){var c=i.channels[h],p=i.samplers[c.sampler],d=c.target,f=void 0!==d.node?d.node:d.id,v=void 0!==i.parameters?i.parameters[p.input]:p.input,m=void 0!==i.parameters?i.parameters[p.output]:p.output;n.push(this.getDependency("node",f)),a.push(this.getDependency("accessor",v)),r.push(this.getDependency("accessor",m)),s.push(p),o.push(d)}return u.a.all([u.a.all(n),u.a.all(a),u.a.all(r),u.a.all(s),u.a.all(o)]).then(function(n){for(var a=n[0],r=n[1],s=n[2],o=n[3],h=n[4],l=[],u=0,c=a.length;u<c;u++){var p=a[u],d=r[u],f=s[u],v=o[u],m=h[u];if(void 0!==p){var g;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,N[m.path]){case N.weights:g=e.NumberKeyframeTrack;break;case N.rotation:g=e.QuaternionKeyframeTrack;break;case N.position:case N.scale:default:g=e.VectorKeyframeTrack}var y=p.name?p.name:p.uuid,w=void 0!==v.interpolation?H[v.interpolation]:e.InterpolateLinear,x=[];N[m.path]===N.weights?p.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)}):x.push(y);for(var M=0,S=x.length;M<S;M++){var T=new g(x[M]+"."+N[m.path],e.AnimationUtils.arraySlice(d.array,0),e.AnimationUtils.arraySlice(f.array,0),w);"CUBICSPLINE"===v.interpolation&&(T.createInterpolant=function(e){return new k(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(T)}}}var b=void 0!==i.name?i.name:"animation_"+t;return new e.AnimationClip(b,void 0,l)})},ee.prototype.loadNode=function(t){var i=this.json,n=this.extensions,a=this,r=i.meshReferences,s=i.meshUses,o=i.nodes[t];return(!0===o.isBone?u.a.resolve(new e.Bone):void 0!==o.mesh?a.getDependency("mesh",o.mesh).then(function(e){var t;if(r[o.mesh]>1){var i=s[o.mesh]++;(t=e.clone()).name+="_instance_"+i,t.onBeforeRender=e.onBeforeRender;for(var n=0,a=t.children.length;n<a;n++)t.children[n].name+="_instance_"+i,t.children[n].onBeforeRender=e.children[n].onBeforeRender}else t=e;return void 0!==o.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,i=o.weights.length;t<i;t++)e.morphTargetInfluences[t]=o.weights[t]}),t}):void 0!==o.camera?a.getDependency("camera",o.camera):o.extensions&&o.extensions[g.KHR_LIGHTS_PUNCTUAL]&&void 0!==o.extensions[g.KHR_LIGHTS_PUNCTUAL].light?a.getDependency("light",o.extensions[g.KHR_LIGHTS_PUNCTUAL].light):u.a.resolve(new e.Object3D)).then(function(t){if(void 0!==o.name&&(t.name=e.PropertyBinding.sanitizeNodeName(o.name)),Y(t,o),o.extensions&&Z(n,t,o),void 0!==o.matrix){var i=new e.Matrix4;i.fromArray(o.matrix),t.applyMatrix(i)}else void 0!==o.translation&&t.position.fromArray(o.translation),void 0!==o.rotation&&t.quaternion.fromArray(o.rotation),void 0!==o.scale&&t.scale.fromArray(o.scale);return t})},ee.prototype.loadScene=function(){function t(i,n,a,r){var s=a.nodes[i];return r.getDependency("node",i).then(function(t){return void 0===s.skin?t:r.getDependency("skin",s.skin).then(function(e){for(var t=[],n=0,a=(i=e).joints.length;n<a;n++)t.push(r.getDependency("node",i.joints[n]));return u.a.all(t)}).then(function(n){for(var a=!0===t.isGroup?t.children:[t],r=0,s=a.length;r<s;r++){for(var o=a[r],h=[],l=[],u=0,c=n.length;u<c;u++){var p=n[u];if(p){h.push(p);var d=new e.Matrix4;void 0!==i.inverseBindMatrices&&d.fromArray(i.inverseBindMatrices.array,16*u),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[u])}o.bind(new e.Skeleton(h,l),o.matrixWorld)}return t});var i}).then(function(e){n.add(e);var i=[];if(s.children)for(var o=s.children,h=0,l=o.length;h<l;h++){var c=o[h];i.push(t(c,e,a,r))}return u.a.all(i)})}var i=this.json,n=this.extensions,a=this.json.scenes[0],r=new e.Scene;void 0!==a.name&&(r.name=a.name),Y(r,a),a.extensions&&Z(n,r,a);for(var s=a.nodes||[],o=[],h=0,l=s.length;h<l;h++)o.push(t(s[h],r,i,this));return u.a.all(o).then(function(){return r})}}).call(t,i("Ml+6"))},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t,n,a,r=i("cbRa"),s=i("c6m3");t=new r.a,n=new s.a,a=document.getElementById("canvas"),n.init(a),t.setGame(n),e("#foreground").click(function(t){var i=e("#canvas").offset(),a={};a.x=t.pageX-i.left,a.y=t.pageY-i.top,n.click(a.x,a.y)}),t.start("TEST")}.call(t,i("7t+N"))},"Rr+P":function(e,t,i){"use strict";var n=i("fZjL"),a=i.n(n),r=i("pFYg"),s=i.n(r),o=i("OvRC"),h=i.n(o),l=i("XDXK"),u=function(e,t,i,n,a,r,s){this.parseSheet(r,s),this.scale=void 0!==i?i:1,this.setText(t);n=void 0!==n?n:0,a=void 0!==a?a:0;var o=this.calculateDimensions();l.a.bind(this)(e,n,a,o.width,o.height),this.pivot.x=0,this.pivot.y=0};(u.prototype=h()(l.a.prototype)).setText=function(e){if(this.text!==e){this.text=void 0!==e?e.toString():"",this.characters=this.text.split("");var t=this.calculateDimensions();this.width=t.width,this.height=t.height}},u.prototype.parseSheet=function(e,t){if(void 0===e&&!this.sheet)throw new Error("Sheet image path missing when creating sprite from sheet");if(void 0===t&&!this.sheetData)throw new Error("Sheet data path missing when creating sprite from sheet");if(!e&&this.sheet||(this.sheet=AssetLoader.getAssetById(e)),!t&&this.sheetData||(this.sheetData=AssetLoader.getAssetById(t)),"object"!==s()(this.sheetData))throw new Error("Invalid sheet data "+t+" -- not an object");this.characterData={};for(var i=a()(this.sheetData),n=i.length,r=0;r<n;r++){var o=i[r],h=this.sheetData[o];h.uv0[0]=Math.min(1,Math.max(0,h.uv0[0])),h.uv0[1]=Math.min(1,Math.max(0,h.uv0[1])),h.uv1[0]=Math.min(1,Math.max(0,h.uv1[0])),h.uv1[1]=Math.min(1,Math.max(0,h.uv1[1])),this.characterData[o]={x:Math.round(h.uv0[0]*this.sheet.width),y:Math.round((1-h.uv0[1])*this.sheet.height),width:Math.round((h.uv1[0]-h.uv0[0])*this.sheet.width),height:Math.round((h.uv0[1]-h.uv1[1])*this.sheet.height)};var l=this.characterData[o];l.width=Math.max(1e-5,l.width),l.height=Math.max(1e-5,l.height)}},u.prototype.calculateDimensions=function(){for(var e={width:0,height:0},t=this.characters.length,i=0;i<t;i++){var n=this.characters[i];this.characterData[n]||(n=a()(this.characterData)[0]);var r=this.characterData[n];e.width+=r?r.width:0,e.height=Math.max(e.height,r?r.height:0)}return e.width*=this.scale,e.height*=this.scale,e},u.prototype.draw=function(e,t,i){for(var n=this.characters.length,a=0;a<n;a++){var r=this.characters[a],s=this.drawCharacter(e,r,t,i);t=s.x+s.width,i=s.y}},u.prototype.drawCharacter=function(e,t,i,n){var a=this.characterData[t],r=!1;void 0===a&&(a={width:6,height:6},r=!0);var s=a.width*this.scale,o=a.height*this.scale;return r||e.drawImage(this.sheet,a.x,a.y,a.width,a.height,i,n,s,o),{x:i,y:n,width:s,height:o}},t.a=u},TAbc:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),s=i.n(r),o=function(){function e(){a()(this,e),this.startValue=0,this.endValue=0,this.duration=0,this.inProgress=!1}return s()(e,[{key:"start",value:function(e,t,i,n,a,r){this.startTime=e,this.updateFunction=t,this.stopFunction=i,this.startValue=n,this.endValue=a,this.duration=r,this.inProgress=!0,this.count=0}},{key:"step",value:function(e){if(this.inProgress)if(this.count>0)this.count-=1,log.debug(e+": jumped frame");else{var t=e-this.startTime;t>this.duration&&(t=this.duration);var i=this.endValue-this.startValue,n=this.startValue+i/this.duration*t;n=Math.round(n),t===this.duration||n===this.endValue?(this.stop(),this.stopFunction&&this.stopFunction()):this.updateFunction&&this.updateFunction(n)}}},{key:"restart",value:function(e,t,i){this.start(e,this.updateFunction,this.stopFunction,t,i,this.duration),this.step(e)}},{key:"stop",value:function(){this.inProgress=!1}}]),e}();t.a=o},"X+Uv":function(e,t,i){"use strict";(function(e){var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),s=i.n(r),o=i("yh7f"),h=i("DwfQ"),l=i("ZQ2e"),u=i("zTqn"),c=function(){function t(){a()(this,t)}return s()(t,null,[{key:"createEntity",value:function(i,n,a){if(i){if(!e.isFunction(t.builders[i]))throw Error(i+" is not a valid Entity type");return t.builders[i](n,a)}}}]),t}();c.builders=[],c.builders[o.a.Entities.DEATHKNIGHT]=function(e){return new u.a(e,o.a.Entities.DEATHKNIGHT)},c.builders[o.a.Entities.CHEST]=function(e){return new l.a(e)},c.builders[o.a.Entities.FIRE]=function(e){var t=new h.a(e,o.a.Entities.FIRE);return t.attachPointLight(16760992,1,128),t},t.a=c}).call(t,i("rdLu"))},XDXK:function(e,t,i){"use strict";var n=i("fZjL"),a=i.n(n),r=i("uL5Q"),s=function(e,t,i,n,a){this.ui=e,this.x=void 0!==t?t:0,this.y=void 0!==i?i:0,this.width=void 0!==n?n:0,this.height=void 0!==a?a:0,this.rotation=0,this.alpha=1,this.visible=!0,this.pivot={x:.5,y:.5},this.anchor={x:r.a.left,y:r.a.top},this.smoothing=!0,this.stretch={x:!1,y:!1},this.offset={left:0,top:0,right:0,bottom:0},this.parent=void 0};s.prototype.getBounds=function(){var e=this.determinePositionInCanvas(),t=this.determineDimensionsInCanvas();return{x:e.x,y:e.y,width:t.width,height:t.height}},s.prototype.getParentBounds=function(){if(void 0===this.parent)return{x:0,y:0,width:this.ui.width,height:this.ui.height};if(this.parent instanceof s)return this.parent.getBounds();throw new Error("DisplayObject.parent should always be an instance of DisplayObject")},s.prototype.determinePositionInCanvas=function(){var e={x:"number"==typeof this.x?this.x:0,y:"number"==typeof this.y?this.y:0};return e=this.adjustPositionForAnchor(e.x,e.y),e=this.adjustPositionForPivot(e.x,e.y)},s.prototype.determineDimensionsInCanvas=function(){return{width:"number"==typeof this.width?this.width:0,height:"number"==typeof this.height?this.height:0}},s.prototype.adjustPositionForAnchor=function(e,t){var i=this.getParentBounds();return this.anchor.x===r.a.left?e+=i.x:this.anchor.x===r.a.right?e+=i.x+i.width-this.width:this.anchor.x===r.a.center&&(e+=i.x+i.width/2-this.width/2),this.anchor.y===r.a.top?t+=i.y:this.anchor.y===r.a.bottom?t+=i.y+i.height-this.height:this.anchor.y===r.a.center&&(t+=i.y+i.height/2-this.height/2),{x:e,y:t}},s.prototype.getOffsetInCanvas=function(){for(var e,t={left:this.offset.left,top:this.offset.top,right:this.offset.right,bottom:this.offset.bottom},i=a()(t),n=i.length,r=0;r<n;r++){var s=i[r],o=t[s];if("number"!=typeof o){e=e||this.getParentBounds();var h=parseFloat(o.match(/^([0-9\.]+)%$/)[1]);t[s]=h/100*e.width}}return t},s.prototype.adjustPositionForPivot=function(e,t){return{x:e-=this.width*this.pivot.x,y:t-=this.height*this.pivot.y}},s.prototype.shouldReceiveEvents=function(){return this.visible},s.prototype.onClick=function(e){this.ui.addEventListener("click",e,this)},s.prototype.render=function(e){if(this.visible){e.save();var t=this.getBounds();e.globalAlpha=this.alpha,void 0!==e.mozImageSmoothingEnabled&&(e.mozImageSmoothingEnabled=this.smoothing),void 0!==e.webkitImageSmoothingEnabled&&(e.webkitImageSmoothingEnabled=this.smoothing),void 0!==e.msImageSmoothingEnabled&&(e.msImageSmoothingEnabled=this.smoothing),void 0!==e.imageSmoothingEnabled&&(e.imageSmoothingEnabled=this.smoothing),this.draw(e,t.x,t.y,t.width,t.height),e.restore()}},s.draw=function(e,t,i,n,a){},Object.defineProperty(s.prototype,"_proxied_visible",{get:function(){return!(this.parent&&this.parent!==this&&!this.parent.visible)&&this._visible},set:function(e){return this._visible=e}}),t.a=s},YAyI:function(e,t,i){"use strict";var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),s=i.n(r),o=i("zwoO"),h=i.n(o),l=i("Pf15"),u=i.n(l),c=i("wxAW"),p=i.n(c),d=function(){function e(){s()(this,e)}return p()(e,[{key:"begin",value:function(){this.begin_callback&&this.begin_callback()}},{key:"end",value:function(){this.end_callback&&this.end_callback()}},{key:"click",value:function(e,t){this.click_callback&&this.click_callback(e,t)}},{key:"onBegin",value:function(e){this.begin_callback=e}},{key:"onEnd",value:function(e){this.end_callback=e}},{key:"transitionTo",value:function(e){}},{key:"onClick",value:function(e){this.click_callback=e}},{key:"onUpdate",value:function(e){this.update_callback=e}},{key:"update",value:function(){this.update_callback&&this.update_callback()}}]),e}(),f=i("BO1k"),v=i.n(f),m=i("X+Uv"),g=i("yh7f"),y=i("AeT2"),w={linear:function(e){return e},outCubic:function(e){return(e-=1)*e*e+1},inCubic:function(e){return e*e*e},inOutCubic:function(e){return(e*=2)<1?e*e*e/2:((e-=2)*e*e+2)/2},inOutSine:function(e){return(1-Math.cos(Math.PI*e))/2},outExponential:function(e){return e<1?1-Math.pow(2,-10*e):1},outBounce:function(e){return e<4/11?121*e*e/16:e<8/11?9.075*e*e-9.9*e+3.4:e<.9?4356/361*e*e-35442/1805*e+16061/1805:10.8*e*e-20.52*e+10.72},outBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1}},x={Loop:1,Stop:2,Destory:3},M=function(){function e(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];s()(this,e),Array.isArray(i)||(i=[i]),this._timelines=i,this._frame=0,this._playing=!1,this._stopHandler=null,this._mode=x.Stop;var a=0,r=!0,o=!1,h=void 0;try{for(var l,u=v()(i);!(r=(l=u.next()).done);r=!0){var c=l.value;a=Math.max(a,c.endFrame)}}catch(e){o=!0,h=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw h}}this._lastFrame=a}return p()(e,null,[{key:"Timeline",value:function(e,t,i,n){return Array.isArray(n)||(n=[n]),{startFrame:e,endFrame:t,mesh:i,tweens:n}}}]),p()(e,[{key:"playAndStop",value:function(e){this._playing=!0,this._mode=x.Stop,this._stopHandler=e}},{key:"playAndDestroy",value:function(e){this._playing=!0,this._mode=x.Destory,this._stopHandler=e}},{key:"playLoop",value:function(){this._playing=!0,this._mode=x.Loop}},{key:"update",value:function(){if(this._frame++,this._playing){if(this._frame>=this._lastFrame)switch(this._mode){case x.Loop:this._frame=1;break;case x.Destory:return void(this._stopHandler&&this._stopHandler());default:this._playing=!1,this._frame=this._lastFrame,this._stopHandler&&this._stopHandler()}var e=!0,t=!1,i=void 0;try{for(var n,a=v()(this._timelines);!(e=(n=a.next()).done);e=!0){var r=n.value;if(!(this._frame<r.startFrame||r.endFrame<this._frame)){var s=r.endFrame-r.startFrame,o=s>0?(this._frame-r.startFrame)/s:0,h=r.mesh,l=!0,u=!1,c=void 0;try{for(var p,d=v()(r.tweens);!(l=(p=d.next()).done);l=!0){var f=p.value,m=f[0],g=f[1],y=f[2],M=(0,w[f[3]])(o)*(y-g)+g;switch(m){case"scaleX":case"scaleY":case"scale":break;case"x":h.position.x=M;break;case"y":h.position.y=M;break;case"alpha":h.material.transparent=!0,h.material.opacity=M;break;case"rotation":image.setRotation(M)}}}catch(e){u=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(u)throw c}}}}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}}}}]),e}(),S=function(e){function t(e){s()(this,t);var i=h()(this,(t.__proto__||a()(t)).call(this));return i.teams=[null,null],i.playerSide=null,i.playerTeam=null,i.turn=0,i.state=g.a.BattleState.BEGIN,i.onBegin(function(){console.log("배틀을 시작합니다");var t=m.a.createEntity(g.a.Entities.DEATHKNIGHT,11);t.setSprite(e.sprites.deathknight),t.setGridPosition(8,3),e.addEntity(t);var n=!0,a=!1,r=void 0;try{for(var s,o=v()(t.shatters);!(n=(s=o.next()).done);n=!0){var h=s.value;e.scene.add(h)}}catch(e){a=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}t.mesh.material.transparent=!0,t.mesh.material.opacity=0,t.fadeIn(e.currentTime),i.playerSide=0,i.teams[0]=e.player,i.teams[1]=t,i.playerTeam=i.teams[i.playerSide];var l=e.ui,u=l.createRectangle("#FF6D92",400,250,100,50);u.anchor.x=y.a.anchors.left,u.anchor.y=y.a.anchors.top;var c=l.createText("Attack",20,"Arial","white");c.textAlign="center",c.textBaseline="middle",c.anchor.x=y.a.anchors.center,c.anchor.y=y.a.anchors.center,c.parent=u,u.onClick(function(){i.attack(e.player,t)}),u.visible=!1,i.controlUI=u}),i.onUpdate(function(){if(i.state===g.a.BattleState.BEGIN)i.turn++,i.isPlayerTurn()&&i.showPlayerUI(),i.state=g.a.BattleState.MAIN;else if(i.state===g.a.BattleState.MAIN){var e=!0,t=!1,n=void 0;try{for(var a,r=v()(i.teams);!(e=(a=r.next()).done);e=!0){a.value.isDead}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}else i.state===g.a.BattleState.END&&i.isPlayerTurn()&&i.hidePlayerUI();i.attackerMovie&&i.attackerMovie.update(),i.deadMovie&&i.deadMovie.update()}),i}return u()(t,e),p()(t,[{key:"showPlayerUI",value:function(){this.controlUI.visible=!0}},{key:"hidePlayerUI",value:function(){this.controlUI.visible=!1}},{key:"isPlayerTurn",value:function(){return(this.turn+1)%2===this.playerSide}},{key:"attack",value:function(e,t){var i=this,n=e.mesh.position,a=t.mesh.position;this.attackerMovie=new M(new M.Timeline(0,30,e.mesh,[["x",n.x,(a.x+n.x)/2,"linear"],["y",n.y,n.y+10,"outCubic"]]),new M.Timeline(31,60,e.mesh,[["x",(a.x+n.x)/2,a.x,"linear"],["y",n.y+10,n.y,"inCubic"]]),new M.Timeline(61,70,e.mesh,[["x",a.x,a.x,"linear"],["y",n.y,n.y,"linear"]]),new M.Timeline(71,100,e.mesh,[["x",a.x,(a.x+n.x)/2,"linear"],["y",n.y,n.y+10,"outCubic"]]),new M.Timeline(101,130,e.mesh,[["x",(a.x+n.x)/2,n.x,"linear"],["y",n.y+10,n.y,"inCubic"]])),this.attackerMovie.playAndDestroy(function(){i.attackerMovie=null,i.deadMovie=new M(new M.Timeline(0,30,t.mesh,[["alpha",1,0,"linear"]])),i.deadMovie.playAndDestroy(function(){i.deadMovie=null,i.state=g.a.BattleState.END})})}}]),t}(d),T=function(e){function t(e,i){s()(this,t);var n=h()(this,(t.__proto__||a()(t)).call(this));return n.game=e,n.kind=i,n.onBegin(function(){"enter"===i&&(e.player.mesh.visible=!1,n.skipFrame=60)}),n.onUpdate(function(){"enter"===i&&(n.skipFrame>0?--n.skipFrame:e.player.mesh.visible?e.player.isFading||(e.nextPhase=new S(e)):(e.player.mesh.visible=!0,e.player.mesh.material.transparent=!0,e.player.mesh.material.opacity=0,e.player.fadeIn(e.currentTime)))}),n}return u()(t,e),t}(d);t.a=T},ZQ2e:function(e,t,i){"use strict";var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),s=i.n(r),o=i("zwoO"),h=i.n(o),l=i("Pf15"),u=i.n(l),c=i("yh7f"),p=function(e){function t(e){return s()(this,t),h()(this,(t.__proto__||a()(t)).call(this,e,c.a.Entities.CHEST))}return u()(t,e),t}(i("DwfQ").a);t.a=p},"b8n+":function(e,t,i){"use strict";var n=i("pFYg"),a=i.n(n),r=i("OvRC"),s=i.n(r),o=i("XDXK"),h=function(e,t,i,n,a,r,s,h){this.setAssetPath(t,s,h);i=void 0!==i?i:0,n=void 0!==n?n:0,a=void 0!==a?a:null,r=void 0!==r?r:null;this.asset?(a=null!==a?a:this.asset.width,r=null!==r?r:this.asset.height):this.sheet&&this.sheetImageData&&(a=null!==a?a:this.sheetImageData.frame.w,r=null!==r?r:this.sheetImageData.frame.h),o.a.bind(this)(e,i,n,a,r)};(h.prototype=s()(o.a.prototype)).draw=function(e,t,i,n,a){this.sheet&&this.sheetImageData?e.drawImage(this.sheet,this.sheetImageData.frame.x,this.sheetImageData.frame.y,this.sheetImageData.frame.w,this.sheetImageData.frame.h,t,i,n,a):e.drawImage(this.asset,t,i,n,a)},h.prototype.setAssetPath=function(e,t,i){this.assetPath=e,void 0!==t||this.sheet?(this.asset=null,this.parseSheet(e,t,i)):(this.asset=AssetLoader.getAssetById(e),this.sheet=null)},h.prototype.parseSheet=function(e,t,i){if(void 0===i&&!this.sheetData)throw new Error("Sheet data path missing when creating sprite from sheet");if(!t&&this.sheet||(this.sheet=AssetLoader.getAssetById(t)),!i&&this.sheetData||(this.sheetData=AssetLoader.getAssetById(i)),"object"!==a()(this.sheetData))throw new Error("Invalid sheet data "+i+" -- not an object");if(!this.sheetData.frames)throw new Error("Invalid sheet data "+i+" -- does not have frames");var n;if(this.sheetData.frames.forEach(function(t){t.filename===e&&(n=t)}),!n)throw new Error('Asset "'+e+'" does not exist in sheet "'+i+'"');this.sheetImageData=n},t.a=h},c6m3:function(e,t,i){"use strict";(function(e,n){var a=i("BO1k"),r=i.n(a),s=i("Zrlr"),o=i.n(s),h=i("wxAW"),l=i.n(h),u=i("1fqz"),c=i("fzpQ"),p=i("ITPp"),d=i("GoZD"),f=i("m3jU"),v=i("X+Uv"),m=i("N9/5"),g=i("wVBE"),y=i.n(g),w=i("ZQ2e"),x=i("YAyI"),M=i("AeT2"),S=function(){function t(){o()(this,t)}return l()(t,[{key:"init",value:function(t){var i=new e.Scene,n=new e.PerspectiveCamera(30,t.width/t.height,1,1e3);n.position.set(0,100,250);var a=t.width,r=t.height,s=new e.WebGLRenderer({canvas:t});s.shadowMap.enabled=!0,s.setPixelRatio(window.devicePixelRatio),s.setSize(a,r);var o=new M.a(t,r);this.renderer=s,this.camera=n,this.scene=i,this.ui=o;var h=10,l=10,u=16,c=new e.PlaneBufferGeometry(h*u,l*u,h,l),p=new e.MeshStandardMaterial({color:4214848,roughness:.75}),d=new e.Mesh(c,p);d.rotation.order="YXZ",d.rotation.x=-Math.PI/2,d.receiveShadow=!0,c.computeBoundingBox(),this._terrain=d,n.lookAt(new e.Vector3(0,0,0)),new y.a(n,s.domElement),this.entities={},this.entityGrid=null,this.phase=null,this.nextPhase=null}},{key:"tick",value:function(){this.currentTime=(new Date).getTime(),this.updater.update(),this.ui.render(),this.renderer.render(this.scene,this.camera),this.isStopped||requestAnimationFrame(this.tick.bind(this))}},{key:"start",value:function(){this.tick()}},{key:"stop",value:function(){this.isStopped=!0}},{key:"run",value:function(t){var i=this;this.loadSprites(),this.loadMap(),this.loadModel(),this.updater=new c.a(this);var n=setInterval(function(){if(i.map.isLoaded&&i.isSpritesLoaded()&&i.model){for(clearInterval(n);i.scene.children.length>0;)i.scene.remove(i.scene.children[0]);i.scene.add(i._terrain),i.initEntityGrid(),f.a.setGridSize(i.map.tilesize);var a=new e.HemisphereLight(16777215,16777215,1);a.color.setHSL(.6,1,.6),a.groundColor.setHSL(.095,1,.75),a.position.set(0,50,0),i.scene.add(a);var s=2,o=!0,h=!1,l=void 0;try{for(var c,p=r()(i.map.props);!(o=(c=p.next()).done);o=!0){var m=c.value,g=v.a.createEntity(m.kind,s++,"");g.setGridPosition(m.x,m.y),g instanceof w.a&&(g.mesh=i.model.scene.clone(),g.mesh.scale.set(3,3,3)),i.addEntity(g),i.scene.add(g.mesh)}}catch(e){h=!0,l=e}finally{try{!o&&p.return&&p.return()}finally{if(h)throw l}}i.pathfinder=new d.a(i.map.width,i.map.height);var y=new u.a(1,t,"");y.setSprite(i.sprites.clotharmor),y.onRequestPath(function(e,t){return i.findPath(y,e,t)}),y.onStopPathing(function(e,t){if(y.target instanceof w.a){var n=y.target;y.target=null,requestAnimationFrame(function(){i.removeEntity(n),i.scene.remove(n.mesh)})}}),y.setGridPosition(3,3),i.addEntity(y),i.unregisterEntityPosition(y),i.player=y,i.nextPhase=new x.a(i,"enter"),i.start();var M=!0,S=!1,T=void 0;try{for(var b,_=r()(y.shatters);!(M=(b=_.next()).done);M=!0)b.value}catch(e){S=!0,T=e}finally{try{!M&&_.return&&_.return()}finally{if(S)throw T}}var E=new e.PlaneGeometry(32,32);E.computeFaceNormals(),E.computeBoundingSphere();var k=new e.Texture;k.image=i.sprites.clotharmor_l,console.log(k.image.width,k.image.height),k.format=e.RGBAFormat,k.needsUpdate=!0,k.wrapS=k.wrapT=e.RepeatWrapping,k.repeat.set(.5,-1),k.magFilter=e.NearestFilter,k.minFilter=e.NearestFilter;var A=new e.MeshStandardMaterial({map:k,transparent:!0});A.precision="highhp";var R=new e.Mesh(E,A);i.mesh__=R,i.scene.add(R),console.log(E);var L=new e.SphereGeometry(5,32,32),I=new e.MeshBasicMaterial({transparent:!0,opacity:0}),D=new e.Mesh(L,I);D.scale.set(1,2,1),D.castShadow=!0,R.add(D);var P=0;setInterval(function(){P=(P+1)%2,k.offset.x=P/2},200)}},100)}},{key:"loadSprites",value:function(){var e={},t=function(t){var i=new Image;i.src="static/"+t+".png",i.onload=function(){i.isLoaded=!0},e[t]=i},i=!0,n=!1,a=void 0;try{for(var s,o=r()(["clotharmor","sword1","deathknight","clotharmor_l"]);!(i=(s=o.next()).done);i=!0){t(s.value)}}catch(e){n=!0,a=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}this.sprites=e}},{key:"loadMap",value:function(){this.map=new p.a,this.map.offset={x:this._terrain.geometry.boundingBox.min.x,y:this._terrain.geometry.boundingBox.min.y}}},{key:"loadModel",value:function(){var e=this;(new m.a).load("static/treasure.glb",function(t){e.model=t},void 0,function(e){console.error(e)})}},{key:"isSpritesLoaded",value:function(){return!n.any(this.sprites,function(e){return!e.isLoaded})}},{key:"initEntityGrid",value:function(){this.entityGrid=[];for(var e=0;e<this.map.height;e+=1){this.entityGrid[e]=[];for(var t=0;t<this.map.width;t+=1)this.entityGrid[e][t]={}}}},{key:"addEntity",value:function(e){void 0===this.entities[e.id]&&(this.entities[e.id]=e,this.registerEntityPosition(e))}},{key:"removeEntity",value:function(e){e.id in this.entities&&(this.unregisterEntityPosition(e),delete this.entities[e.id])}},{key:"registerEntityPosition",value:function(e){var t=e.gridX,i=e.gridY;this.entityGrid[i][t][e.id]=e}},{key:"unregisterEntityPosition",value:function(e){var t=e.gridX,i=e.gridY;this.entityGrid[i][t][e.id]&&delete this.entityGrid[i][t][e.id]}},{key:"getEntityAt",value:function(e,t){if(this.map.isOutOfBounds(e,t)||!this.entityGrid)return null;var i=this.entityGrid[t][e],a=null;return n.size(i)>0&&(a=i[n.keys(i)[0]]),a}},{key:"getItemAt",value:function(e,t){return null}},{key:"getGridPosition",value:function(e,t){var i=this.map.tilesize;return{x:Math.floor((e.x-t.min.x)/i),y:Math.floor((e.z-t.min.y)/i)}}},{key:"click",value:function(t,i){if(this.ui&&this.ui.clickHandler(t,i))return;this.phase&&this.phase.click(t,i);var n=new e.Vector2;this.renderer.getSize(n);var a=new e.Vector2;a.x=t/n.x*2-1,a.y=-i/n.y*2+1;var s=new e.Raycaster;s.setFromCamera(a,this.camera);var o=s.intersectObjects(this.scene.children),h=!0,l=!1,u=void 0;try{for(var c,p=r()(o);!(h=(c=p.next()).done);h=!0){var d=c.value,f=this.getGridPosition(d.point,this._terrain.geometry.boundingBox),v=this.getEntityAt(f.x,f.y);v instanceof w.a?(this.player.setTarget(v),this.player.follow(v)):this.player.go(f.x,f.y)}}catch(e){l=!0,u=e}finally{try{!h&&p.return&&p.return()}finally{if(l)throw u}}}},{key:"forEachEntity",value:function(e){n.each(this.entities,function(t){e(t)})}},{key:"findPath",value:function(e,t,i){return this.map.isColliding(t,i)?[]:this.pathfinder&&e?this.pathfinder.findPath(this.map.grid,e,t,i,!1):[]}}]),t}();t.a=S}).call(t,i("Ml+6"),i("rdLu"))},cbRa:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),s=i.n(r),o=function(){function e(){a()(this,e)}return s()(e,[{key:"setGame",value:function(e){this.game=e}},{key:"center",value:function(){window.scrollTo(0,1)}},{key:"start",value:function(e){this.center(),this.game.run()}}]),e}();t.a=o},fzpQ:function(e,t,i){"use strict";var n=i("BO1k"),a=i.n(n),r=i("Zrlr"),s=i.n(r),o=i("wxAW"),h=i.n(o),l=i("zTqn"),u=i("yh7f"),c=function(){function e(t){s()(this,e),this.game=t}return h()(e,[{key:"update",value:function(){this.updateEntities(),this.updateTransitions(),this.updatePhase()}},{key:"updateEntities",value:function(){var e=this;this.game.forEachEntity(function(t){t instanceof l.a&&t.isLoaded&&e.updateCharacter(t),e.updateEntityFading(t)})}},{key:"updateCharacter",value:function(e){var t=Math.round(16/Math.round(e.moveSpeed/(1e3/60)));e.isMoving()&&!1===e.movement.inProgress&&(e.orientation===u.a.Orientations.LEFT?e.movement.start(this.game.currentTime,function(t){e.x=t,e.hasMoved()},function(){e.x=e.movement.endValue,e.hasMoved(),e.nextStep()},e.x-t,e.x-16,e.moveSpeed):e.orientation===u.a.Orientations.RIGHT?e.movement.start(this.game.currentTime,function(t){e.x=t,e.hasMoved()},function(){e.x=e.movement.endValue,e.hasMoved(),e.nextStep()},e.x+t,e.x+16,e.moveSpeed):e.orientation===u.a.Orientations.UP?e.movement.start(this.game.currentTime,function(t){e.y=t,e.hasMoved()},function(){e.y=e.movement.endValue,e.hasMoved(),e.nextStep()},e.y-t,e.y-16,e.moveSpeed):e.orientation===u.a.Orientations.DOWN&&e.movement.start(this.game.currentTime,function(t){e.y=t,e.hasMoved()},function(){e.y=e.movement.endValue,e.hasMoved(),e.nextStep()},e.y+t,e.y+16,e.moveSpeed))}},{key:"updateTransitions",value:function(){var e=this,t=this.game.map.offset.x+this.game.map.tilesize/2,i=this.game.map.offset.y+this.game.map.tilesize/2;this.game.forEachEntity(function(n){var r=n.movement;if(r&&r.inProgress&&r.step(e.game.currentTime),n.mesh&&n.mesh.position.set(t+n.x+n.offset.x,0+n.offset.y,i+n.y+n.offset.z),n.shatters){var s=!0,o=!1,h=void 0;try{for(var l,u=a()(n.shatters);!(s=(l=u.next()).done);s=!0){var c=l.value;c._pos_init||(c.position.x+=n.mesh.position.x,c.position.z+=n.mesh.position.z,c._pos_init=!0,c.shatterTick=100*Math.random());--c.shatterTick,c.shatterTick<0&&(Math.abs(n.mesh.position.x-c.position.x)<1?c.position.x=n.mesh.position.x:c.position.x+=1/(n.mesh.position.x-c.position.x),Math.abs(n.mesh.position.y-c.position.y)<3?c.position.y=n.mesh.position.y:c.position.y+=3/(n.mesh.position.y-c.position.y),Math.abs(n.mesh.position.z-c.position.z)<1?c.position.z=n.mesh.position.z:c.position.z+=1/(n.mesh.position.z-c.position.z))}}catch(e){o=!0,h=e}finally{try{!s&&u.return&&u.return()}finally{if(o)throw h}}}}),this.game.mesh__&&(this.game.mesh__.position.copy(this.game.player.mesh.position),this.game.mesh__.position.y=11)}},{key:"updateEntityFading",value:function(e){if(e&&e.isFading){var t=this.game.currentTime-e.startFadingTime;t>1e3?(e.isFading=!1,e.mesh&&(e.mesh.material.opacity=1,e.mesh.material.transparent=!1)):e.mesh&&(e.mesh.material.transparent=!0,e.mesh.material.opacity=t/1e3)}}},{key:"updatePhase",value:function(){this.game.nextPhase&&(this.game.phase?(this.game.phase.end(),this.game.phase=null):(this.game.phase=this.game.nextPhase,this.game.nextPhase=null,this.game.phase.begin())),this.game.phase&&this.game.phase.update()}}]),e}();t.a=c},jQdr:function(e,t){var i=/firefox/i.test(navigator.userAgent);e.exports.isFirefox=i},m3jU:function(e,t,i){"use strict";var n=i("Zrlr"),a=i.n(n),r=i("wxAW"),s=i.n(r),o=function(){function e(t,i){a()(this,e),this.id=t,this.kind=i,this.isLoaded=!1}return s()(e,[{key:"setPosition",value:function(e,t){this.x=e,this.y=t}},{key:"setGridPosition",value:function(t,i){this.gridX=t,this.gridY=i,this.setPosition(t*e.gridSize,i*e.gridSize)}},{key:"fadeIn",value:function(e){this.isFading=!0,this.startFadingTime=e}}],[{key:"setGridSize",value:function(t){e.gridSize=t}}]),e}();t.a=o},tTs3:function(e,t,i){"use strict";var n=i("OvRC"),a=i.n(n),r=i("XDXK"),s=function(e,t,i,n,a,s,o){this.textAlign="left",this.textBaseline="alphabetic",this.text=void 0!==t?t:"",this.size=void 0!==i?i:12,this.font=void 0!==n?n:"Arial",this.color=void 0!==a?a:"#000000",this.lineHeight=1;s=void 0!==s?s:0,o=void 0!==o?o:0;r.a.bind(this)(e,s,o)};(s.prototype=a()(r.a.prototype)).draw=function(e,t,i){e.font=this.size+"px "+this.font,e.fillStyle=this.color,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline;var n=this.text.split("\n"),a=0;"center"===this.textVerticalAlign?a=n.length/2-.5:"bottom"===this.textVerticalAlign&&(a=n.length-1);for(var r=0;r<n.length;r++){var s=n[r],o=i+(r-a)*(this.size*this.lineHeight);e.fillText(s,t,o)}},t.a=s},uL5Q:function(e,t,i){"use strict";t.a={center:1,left:2,right:3,top:4,bottom:5}},wV90:function(e,t,i){"use strict";var n=new Int32Array(4096);t.a={build:function(e,t,i){for(var a=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],r=new Array(a[2]*a[1]*a[0]),s=0,o=e[2];o<t[2];o++)for(var h=e[1];h<t[1];h++)for(var l=e[0];l<t[0];l++)r[s]=i(l,h,o),s++;return function(e,t){for(var i=[],a=[],r=t[0],s=r*t[1],o=0;o<3;++o){var h,l,u,c,p,d,f,v,m,g,y,w,x=(o+1)%3,M=(o+2)%3,S=[0,0,0],T=[0,0,0],b=[0,0,0],_=[0,0,0],E=t[o],k=t[x],A=t[M];for(n.length<k*A&&(n=new Int32Array(k*A)),T[o]=1,S[o]=-1,g=r*T[1],y=s*T[2];S[o]<E;){for(w=S[o],v=0,S[M]=0;S[M]<A;++S[M])for(S[x]=0;S[x]<k;++S[x],++v){var R=w>=0&&e[S[0]+r*S[1]+s*S[2]],L=w<E-1&&e[S[0]+T[0]+r*S[1]+g+s*S[2]+y];n[v]=(R?!L:L)?R||-L:0}for(++S[o],v=0,l=0;l<A;++l)for(h=0;h<k;)if(m=n[v]){for(p=1;m===n[v+p]&&h+p<k;)p++;for(f=1;l+f<A;++f){for(u=0;u<p&&m===n[v+u+f*k];)u++;if(u<p)break}b[o]=0,_[o]=0,S[x]=h,S[M]=l,m>0?(_[M]=f,_[x]=0,b[x]=p,b[M]=0):(m=-m,b[M]=f,b[x]=0,_[x]=p,_[M]=0);var I=i.length;for(i.push([S[0],S[1],S[2]]),i.push([S[0]+b[0],S[1]+b[1],S[2]+b[2]]),i.push([S[0]+b[0]+_[0],S[1]+b[1]+_[1],S[2]+b[2]+_[2]]),i.push([S[0]+_[0],S[1]+_[1],S[2]+_[2]]),a.push([I,I+1,I+2,I+3,m]),d=v+p,c=0;c<f;++c)for(u=v;u<d;++u)n[u+c*k]=0;h+=p,v+=p}else h++,v++}}return{vertices:i,faces:a}}(r,a)},buildCube:function(e,t,i){for(var n=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],a=new Array(n[2]*n[1]*n[0]),r=0,s=e[2];s<t[2];s++)for(var o=e[1];o<t[1];o++)for(var h=e[0];h<t[0];h++)a[r]=i(h,o,s),r++;return function(e,t){var i=[],n=[],a=[0,0,0],r=0;for(a[2]=0;a[2]<t[2];++a[2])for(a[1]=0;a[1]<t[1];++a[1])for(a[0]=0;a[0]<t[0];++a[0],++r)if(e[r])for(var s=0;s<3;++s){var o=[a[0],a[1],a[2]],h=[0,0,0],l=[0,0,0];h[(s+1)%3]=1,l[(s+2)%3]=1;for(var u=0;u<2;++u){o[s]=a[s]+u;var c=h;h=l,l=c;var p=i.length;i.push([o[0],o[1],o[2]]),i.push([o[0]+h[0],o[1]+h[1],o[2]+h[2]]),i.push([o[0]+h[0]+l[0],o[1]+h[1]+l[1],o[2]+h[2]+l[2]]),i.push([o[0]+l[0],o[1]+l[1],o[2]+l[2]]),n.push([p+0,p+1,p+2,p+3,e[r]])}}return{vertices:i,faces:n}}(a,n)}}},yh7f:function(e,t,i){"use strict";t.a={Orientations:{UP:1,DOWN:2,LEFT:3,RIGHT:4},Entities:{PLAYER:1,FIRE:2,CHEST:3,DEATHKNIGHT:4},BattleState:{BEGIN:1,MAIN:2,END:3}}},zTqn:function(e,t,i){"use strict";(function(e){var n=i("Zx67"),a=i.n(n),r=i("Zrlr"),s=i.n(r),o=i("wxAW"),h=i.n(o),l=i("zwoO"),u=i.n(l),c=i("Pf15"),p=i.n(c),d=i("wV90"),f=i("m3jU"),v=i("TAbc"),m=i("yh7f"),g=function(t){function i(e,t){s()(this,i);var n=u()(this,(i.__proto__||a()(i)).call(this,e,t));return n.nextGridX=-1,n.nextGridY=-1,n.orientation=m.a.Orientations.DOWN,n.movement=new v.a,n.path=null,n.newDestination=null,n.adjacentTiles={},n.moveSpeed=120,n.walkSpeed=100,n.idleSpeed=450,n}return p()(i,t),h()(i,[{key:"setSprite",value:function(e){this.sprite=e,this.buildMesh(),this.isLoaded=!0}},{key:"getFramePixelData",value:function(){var e=document.createElement("canvas");e.width=this.sprite.width,e.height=this.sprite.height;var t=e.getContext("2d");t.translate(0,this.sprite.height),t.scale(1,-1),t.drawImage(this.sprite,0,0);return t.getImageData(0,0,32,32)}},{key:"buildMesh",value:function(){if(this.sprite){for(var t=this.getFramePixelData(),i=d.a.build([0,0,0],[t.width,t.height,1],function(e,i,n){var a=4*(e+i*t.width),r=t.data[a+0],s=t.data[a+1],o=t.data[a+2];return 255===t.data[a+3]?(r<<16)+(s<<8)+o:0}),n=new e.Geometry,a=0;a<i.vertices.length;++a){var r=i.vertices[a];n.vertices.push(new e.Vector3(r[0],r[1],r[2]))}for(var s=0;s<i.faces.length;++s){var o=i.faces[s],h=new e.Color(o[4]),l=new e.Face3(o[0],o[1],o[2]);l.color=h,l.vertexColors=[h,h,h],n.faces.push(l);var u=new e.Face3(o[2],o[3],o[0]);u.color=h,u.vertexColors=[h,h,h],n.faces.push(u)}n.computeFaceNormals(),n.verticesNeedUpdate=!0,n.elementsNeedUpdate=!0,n.normalsNeedUpdate=!0,n.computeBoundingBox();var c=new e.MeshLambertMaterial({vertexColors:!0}),p=new e.Mesh(n,c);p.doubleSided=!1,p.castShadow=!0;var f=n.boundingBox.min;n.boundingBox.max;this.offset={x:-16,y:-f.y,z:0},this.mesh=p;for(var v=d.a.buildCube([0,0,0],[t.width,t.height,1],function(e,i,n){var a=4*(e+i*t.width),r=t.data[a+0],s=t.data[a+1],o=t.data[a+2];return 255===t.data[a+3]?(r<<16)+(s<<8)+o:0}),m=[],g=c.clone(),y=0;y<v.vertices.length/24;++y){for(var w=v,x=24*y,M=new e.Geometry,S=0;S<24;++S){var T=w.vertices[S+x];M.vertices.push(new e.Vector3(T[0],T[1],T[2]))}for(var b=0;b<6;++b){var _=6*y,E=w.faces[b+_],k=new e.Color(E[4]),A=new e.Face3(E[0]-x,E[1]-x,E[2]-x);A.color=k,A.vertexColors=[k,k,k],M.faces.push(A);var R=new e.Face3(E[2]-x,E[3]-x,E[0]-x);R.color=k,R.vertexColors=[k,k,k],M.faces.push(R)}M.computeFaceNormals(),M.computeBoundingBox();var L=new e.Mesh(M,g);L.castShadow=!0,m.push(L);var I=Math.random()*Math.PI*2,D=12*Math.random();L.position.set(D*Math.cos(I),-M.boundingBox.min.y,D*Math.sin(I)),this.shatters=m}}}},{key:"requestPathfindingTo",value:function(e,t){return this.request_path_callback?this.request_path_callback(e,t):[]}},{key:"onRequestPath",value:function(e){this.request_path_callback=e}},{key:"onStartPathing",value:function(e){this.start_pathing_callback=e}},{key:"onStopPathing",value:function(e){this.stop_pathing_callback=e}},{key:"onBeforeStep",value:function(e){this.before_step_callback=e}},{key:"onStep",value:function(e){this.step_callback=e}},{key:"isMoving",value:function(){return!(null===this.path)}},{key:"hasMoved",value:function(){this.hasmoved_callback&&this.hasmoved_callback(this)}},{key:"hasNextStep",value:function(){return this.path.length-1>this.step}},{key:"hasChangedItsPath",value:function(){return!(null===this.newDestination)}},{key:"setOrientation",value:function(e){e&&(this.orientation=e)}},{key:"idle",value:function(e){this.setOrientation(e)}},{key:"walk",value:function(e){this.setOrientation(e)}},{key:"go",value:function(e,t){this.followingMode&&(this.followingMode=!1,this.target=null),this.moveTo(e,t)}},{key:"follow",value:function(e){e&&(this.followingMode=!0,this.moveTo(e.gridX,e.gridY))}},{key:"moveTo",value:function(e,t){if(this.destination={gridX:e,gridY:t},this.isMoving())this.continueTo(e,t);else{var i=this.requestPathfindingTo(e,t);this.followPath(i)}}},{key:"stop",value:function(){this.isMoving()&&(this.interrupted=!0)}},{key:"continueTo",value:function(e,t){this.newDestination={x:e,y:t}}},{key:"updateMovement",value:function(){var e=this.path,t=this.step;e[t][0]<e[t-1][0]&&this.walk(m.a.Orientations.LEFT),e[t][0]>e[t-1][0]&&this.walk(m.a.Orientations.RIGHT),e[t][1]<e[t-1][1]&&this.walk(m.a.Orientations.UP),e[t][1]>e[t-1][1]&&this.walk(m.a.Orientations.DOWN)}},{key:"followPath",value:function(e){e.length>1&&(this.path=e,this.step=0,this.followingMode&&e.pop(),this.start_pathing_callback&&this.start_pathing_callback(e),this.nextStep())}},{key:"nextStep",value:function(){var e=!1;if(this.isMoving()){if(this.before_step_callback&&this.before_step_callback(),this.updatePositionOnGrid(),this.interrupted)e=!0,this.interrupted=!1;else if(this.hasNextStep()&&(this.nextGridX=this.path[this.step+1][0],this.nextGridY=this.path[this.step+1][1]),this.step_callback&&this.step_callback(),this.hasChangedItsPath()){var t=this.newDestination.x,i=this.newDestination.y,n=this.requestPathfindingTo(t,i);this.newDestination=null,n.length<2?e=!0:this.followPath(n)}else this.hasNextStep()?(this.step+=1,this.updateMovement()):e=!0;e&&(this.path=null,this.idle(),this.stop_pathing_callback&&this.stop_pathing_callback(this.gridX,this.gridY))}}},{key:"updatePositionOnGrid",value:function(){this.setGridPosition(this.path[this.step][0],this.path[this.step][1])}},{key:"setTarget",value:function(e){this.target!==e&&(this.target=e)}}]),i}(f.a);t.a=g}).call(t,i("Ml+6"))}},["NHnr"]);
//# sourceMappingURL=app.3469d51bebd74ec7d219.js.map