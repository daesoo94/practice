webpackJsonp([1],{"1fqz":function(t,i,e){"use strict";var n=e("Zx67"),a=e.n(n),s=e("Zrlr"),r=e.n(s),o=e("zwoO"),h=e.n(o),u=e("Pf15"),l=e.n(u),c=function(t){function i(t,e,n){r()(this,i);var s=h()(this,(i.__proto__||a()(i)).call(this,t,n));return s.name=e,s}return l()(i,t),i}(e("zTqn").a);i.a=c},DwfQ:function(t,i,e){"use strict";(function(t){var n=e("Zx67"),a=e.n(n),s=e("Zrlr"),r=e.n(s),o=e("wxAW"),h=e.n(o),u=e("zwoO"),l=e.n(u),c=e("Pf15"),d=e.n(c),f=function(i){function e(t,i){r()(this,e);var n=l()(this,(e.__proto__||a()(e)).call(this,t,i));return n.load(),n}return d()(e,i),h()(e,[{key:"load",value:function(){var i=new t.BoxBufferGeometry(8,8,8),e=new t.MeshLambertMaterial({color:16777215}),n=new t.Mesh(i,e);i.computeBoundingBox(),this.mesh=n,this.offset={x:0,y:-i.boundingBox.min.y,z:0},this.isLoaded=!0}},{key:"attachPointLight",value:function(i,e,n){var a=new t.PointLight(i,e,n);a.position.set(0,10,0),a.castShadow=!0,this.mesh.add(a)}}]),e}(e("m3jU").a);i.a=f}).call(i,e("Ml+6"))},GoZD:function(t,i,e){"use strict";var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s);
/**
 * A* (A-Star) algorithm for a path finder
 * @author  Andrea Giammarchi
 * @license Mit Style License
 */
function o(t,i,e,n,a,s,r,o,h,u,l,c,d){return t&&(e&&!h[a][r]&&(c[d++]={x:r,y:a}),n&&!h[a][o]&&(c[d++]={x:o,y:a})),i&&(e&&!h[s][r]&&(c[d++]={x:r,y:s}),n&&!h[s][o]&&(c[d++]={x:o,y:s})),c}function h(t,i,e,n,a,s,r,o,h,u,l,c,d){return t=a>-1,i=s<u,n=o>-1,r<l&&(t&&!h[a][r]&&(c[d++]={x:r,y:a}),i&&!h[s][r]&&(c[d++]={x:r,y:s})),n&&(t&&!h[a][o]&&(c[d++]={x:o,y:a}),i&&!h[s][o]&&(c[d++]={x:o,y:s})),c}function u(t,i,e,n,a,s,r,o,h,u,l,c,d){return c}function l(t,i,e,n,a,s){var r=e-1,o=e+1,h=i+1,u=i-1,l=r>-1&&!n[r][i],c=o<a&&!n[o][i],d=h<s&&!n[e][h],f=u>-1&&!n[e][u],v=[],p=0;return l&&(v[p++]={x:i,y:r}),d&&(v[p++]={x:h,y:e}),c&&(v[p++]={x:i,y:o}),f&&(v[p++]={x:u,y:e}),t(l,c,d,f,r,o,h,u,n,a,s,v,p)}function c(t,i,e,n){return n(e(t.x-i.x),e(t.y-i.y))}function d(t,i,e,n){var a=t.x-i.x,s=t.y-i.y;return n(a*a+s*s)}function f(t,i,e,n){return e(t.x-i.x)+e(t.y-i.y)}var v=function(t,i,e,n){var a,s,r,v,p,y,g,m,k,w=t[0].length,x=t.length,P=w*x,b=Math.abs,_=Math.max,M={},S=[],G=[{x:i[0],y:i[1],f:0,g:0,v:i[0]+i[1]*w}],E=1;switch(e={x:e[0],y:e[1],v:e[0]+e[1]*w},n){case"Diagonal":r=o;case"DiagonalFree":s=c;break;case"Euclidean":r=o;case"EuclideanFree":_=Math.sqrt,s=d;break;default:s=f,r=u}r||(r=h);do{for(y=P,g=0,v=0;v<E;++v)(n=G[v].f)<y&&(y=n,g=v);if((m=G.splice(g,1)[0]).v!=e.v)for(--E,v=0,p=(k=l(r,m.x,m.y,t,x,w)).length;v<p;++v)(a=k[v]).p=m,a.f=a.g=0,a.v=a.x+a.y*w,a.v in M||(a.f=(a.g=m.g+s(a,m,b,_))+s(a,e,b,_),G[E++]=a,M[a.v]=1);else{v=E=0;do{S[v++]=[m.x,m.y]}while(m=m.p);S.reverse()}}while(E);return S},p=function(){function t(i,e){a()(this,t),this.width=i,this.height=e,this.grid=null,this.ignored=[],this.initBlankGrid()}return r()(t,[{key:"initBlankGrid",value:function(){this.blankGrid=[];for(var t=0;t<this.height;t+=1){this.blankGrid[t]=[];for(var i=0;i<this.width;i+=1)this.blankGrid[t][i]=0}}},{key:"findPath",value:function(t,i,e,n,a){var s=[i.gridX,i.gridY],r=[e,n];this.grid=t;var o=v(this.grid,s,r);return 0===o.length&&!0===a&&(o=this.findIncompletePath_(s,r)),o}},{key:"findIncompletePath_",value:function(t,i){for(var e,n=void 0,a=void 0,s=[],r=(e=v(this.blankGrid,t,i)).length-1;r>0;r-=1)if(n=e[r][0],a=e[r][1],0===this.grid[a][n]){s=v(this.grid,t,[n,a]);break}return s}},{key:"ignoreEntity",value:function(t){t&&this.ignored.push(t)}},{key:"clearIgnoreList",value:function(){this.applyIgnoreList_(!1),this.ignored=[]}}]),t}();i.a=p},ITPp:function(t,i,e){"use strict";var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s),o=e("7t+N"),h=e.n(o),u=e("rdLu"),l=(e.n(u),function(t){return t%1==0}),c=function(){function t(i){a()(this,t),this.loadMap()}return r()(t,[{key:"loadMap",value:function(){var t=this;h.a.get("static/maps.json",function(i){t._initMap(i),t._generateCollisionGrid(),t.isLoaded=!0},"json")}},{key:"_initMap",value:function(t){this.width=t.width,this.height=t.height,this.data=t.data,this.tilesize=t.tilesize,this.collisions=t.collisions,this.props=t.props}},{key:"_generateCollisionGrid",value:function(){var t=this;this.grid=[];for(var i=0;i<this.height;i++){this.grid[i]=[];for(var e=0;e<this.width;e++)this.grid[i][e]=0}u.each(this.collisions,function(i){var e=t.tileIndexToGridPosition(i+1);t.grid[e.y][e.x]=1})}},{key:"isColliding",value:function(t,i){return!(this.isOutOfBounds(t,i)||!this.grid)&&1===this.grid[i][t]}},{key:"isOutOfBounds",value:function(t,i){return l(t)&&l(i)&&(t<0||t>=this.width||i<0||i>=this.height)}},{key:"tileIndexToGridPosition",value:function(t){return{x:(t-=1)%this.width,y:Math.floor(t/this.width)}}}]),t}();i.a=c},NHnr:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){var i,n,a,s=e("cbRa"),r=e("c6m3");i=new s.a,n=new r.a,(a=document.getElementById("canvas")).width=800,a.height=400,n.init(a),i.setGame(n),t("#canvas").click(function(i){var e=t("#canvas").offset(),a={};a.x=i.pageX-e.left,a.y=i.pageY-e.top,n.click(a.x,a.y)}),i.start("TEST")}.call(i,e("7t+N"))},TAbc:function(t,i,e){"use strict";var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s),o=function(){function t(){a()(this,t),this.startValue=0,this.endValue=0,this.duration=0,this.inProgress=!1}return r()(t,[{key:"start",value:function(t,i,e,n,a,s){this.startTime=t,this.updateFunction=i,this.stopFunction=e,this.startValue=n,this.endValue=a,this.duration=s,this.inProgress=!0,this.count=0}},{key:"step",value:function(t){if(this.inProgress)if(this.count>0)this.count-=1,log.debug(t+": jumped frame");else{var i=t-this.startTime;i>this.duration&&(i=this.duration);var e=this.endValue-this.startValue,n=this.startValue+e/this.duration*i;n=Math.round(n),i===this.duration||n===this.endValue?(this.stop(),this.stopFunction&&this.stopFunction()):this.updateFunction&&this.updateFunction(n)}}},{key:"restart",value:function(t,i,e){this.start(t,this.updateFunction,this.stopFunction,i,e,this.duration),this.step(t)}},{key:"stop",value:function(){this.inProgress=!1}}]),t}();i.a=o},"X+Uv":function(t,i,e){"use strict";(function(t){var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s),o=e("yh7f"),h=e("DwfQ"),u=e("ZQ2e"),l=function(){function i(){a()(this,i)}return r()(i,null,[{key:"createEntity",value:function(e,n,a){if(e){if(!t.isFunction(i.builders[e]))throw Error(e+" is not a valid Entity type");return i.builders[e](n,a)}}}]),i}();l.builders=[],l.builders[o.a.Entities.CHEST]=function(t){return new u.a(t)},l.builders[o.a.Entities.FIRE]=function(t){var i=new h.a(t,o.a.Entities.FIRE);return i.attachPointLight(16760992,1,128),i},i.a=l}).call(i,e("rdLu"))},ZQ2e:function(t,i,e){"use strict";var n=e("Zx67"),a=e.n(n),s=e("Zrlr"),r=e.n(s),o=e("zwoO"),h=e.n(o),u=e("Pf15"),l=e.n(u),c=e("yh7f"),d=function(t){function i(t){return r()(this,i),h()(this,(i.__proto__||a()(i)).call(this,t,c.a.Entities.CHEST))}return l()(i,t),i}(e("DwfQ").a);i.a=d},c6m3:function(t,i,e){"use strict";(function(t,n){var a=e("BO1k"),s=e.n(a),r=e("Zrlr"),o=e.n(r),h=e("wxAW"),u=e.n(h),l=e("1fqz"),c=e("fzpQ"),d=e("ITPp"),f=e("GoZD"),v=e("X+Uv"),p=e("wVBE"),y=e.n(p),g=e("ZQ2e"),m=function(){function i(){o()(this,i)}return u()(i,[{key:"init",value:function(i){var e=new t.Scene,n=new t.PerspectiveCamera(45,i.width/i.height,1,1e3);n.position.set(0,100,250);var a=new t.WebGLRenderer({canvas:i});a.shadowMap.enabled=!0,a.setPixelRatio(window.devicePixelRatio),a.setSize(i.width,i.height),this.renderer=a,this.camera=n,this.scene=e;var s=10,r=10,o=16,h=new t.PlaneBufferGeometry(s*o,r*o,s,r),u=new t.MeshLambertMaterial({color:4214848}),l=new t.Mesh(h,u);l.rotation.order="YXZ",l.rotation.x=-Math.PI/2,l.receiveShadow=!0,h.computeBoundingBox(),this._terrain=l,n.lookAt(new t.Vector3(0,0,0)),new y.a(n,a.domElement),this.entities={},this.entityGrid=null}},{key:"tick",value:function(){this.currentTime=(new Date).getTime(),this.updater.update(),this.renderer.render(this.scene,this.camera),this.isStopped||requestAnimationFrame(this.tick.bind(this))}},{key:"start",value:function(){this.tick()}},{key:"stop",value:function(){this.isStopped=!0}},{key:"run",value:function(i){var e=this;this.loadSprites(),this.loadMap(),this.updater=new c.a(this);var n=setInterval(function(){if(e.map.isLoaded&&e.isSpritesLoaded()){for(clearInterval(n);e.scene.children.length>0;)e.scene.remove(e.scene.children[0]);e.scene.add(e._terrain),e.initEntityGrid();var a=new t.HemisphereLight(16777215,16777215,1);a.color.setHSL(.6,1,.6),a.groundColor.setHSL(.095,1,.75),a.position.set(0,50,0),e.scene.add(a);var r=2,o=!0,h=!1,u=void 0;try{for(var c,d=s()(e.map.props);!(o=(c=d.next()).done);o=!0){var p=c.value,y=v.a.createEntity(p.kind,r++,"");y.setGridSize(e.map.tilesize),y.setGridPosition(p.x,p.y),e.addEntity(y),e.scene.add(y.mesh)}}catch(t){h=!0,u=t}finally{try{!o&&d.return&&d.return()}finally{if(h)throw u}}e.pathfinder=new f.a(e.map.width,e.map.height);var m=new l.a(1,i,"");m.setSprite(e.sprites.clotharmor),m.onRequestPath(function(t,i){return e.findPath(m,t,i)}),m.onStopPathing(function(t,i){m.target instanceof g.a&&requestAnimationFrame(function(){e.removeEntity(m.target),e.scene.remove(m.target.mesh),m.target=null})}),m.setGridSize(e.map.tilesize),m.setGridPosition(5,3),e.addEntity(m),e.player=m,e.scene.add(e.player.mesh),e.start()}},100)}},{key:"loadSprites",value:function(){var t={},i=function(i){var e=new Image;e.src="static/"+i+".png",e.onload=function(){e.isLoaded=!0},t[i]=e},e=!0,n=!1,a=void 0;try{for(var r,o=s()(["clotharmor","sword1"]);!(e=(r=o.next()).done);e=!0){i(r.value)}}catch(t){n=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw a}}this.sprites=t}},{key:"loadMap",value:function(){this.map=new d.a,this.map.offset={x:this._terrain.geometry.boundingBox.min.x,y:this._terrain.geometry.boundingBox.min.y}}},{key:"isSpritesLoaded",value:function(){return!n.any(this.sprites,function(t){return!t.isLoaded})}},{key:"initEntityGrid",value:function(){this.entityGrid=[];for(var t=0;t<this.map.height;t+=1){this.entityGrid[t]=[];for(var i=0;i<this.map.width;i+=1)this.entityGrid[t][i]={}}}},{key:"addEntity",value:function(t){void 0===this.entities[t.id]&&(this.entities[t.id]=t,this.registerEntityPosition(t))}},{key:"removeEntity",value:function(t){t.id in this.entities&&(this.unregisterEntityPosition(t),delete this.entities[t.id])}},{key:"registerEntityPosition",value:function(t){var i=t.gridX,e=t.gridY;this.entityGrid[e][i][t.id]=t}},{key:"unregisterEntityPosition",value:function(t){var i=t.gridX,e=t.gridY;this.entityGrid[e][i][t.id]&&delete this.entityGrid[e][i][t.id]}},{key:"getEntityAt",value:function(t,i){if(this.map.isOutOfBounds(t,i)||!this.entityGrid)return null;var e=this.entityGrid[i][t],a=null;return n.size(e)>0&&(a=e[n.keys(e)[0]]),a}},{key:"getItemAt",value:function(t,i){return null}},{key:"getGridPosition",value:function(t,i){var e=this.map.tilesize;return{x:Math.floor((t.x-i.min.x)/e),y:Math.floor((t.z-i.min.y)/e)}}},{key:"click",value:function(i,e){var n=new t.Vector2;this.renderer.getSize(n);var a=new t.Vector2;a.x=i/n.x*2-1,a.y=-e/n.y*2+1;var r=new t.Raycaster;r.setFromCamera(a,this.camera);var o=r.intersectObjects(this.scene.children),h=!0,u=!1,l=void 0;try{for(var c,d=s()(o);!(h=(c=d.next()).done);h=!0){var f=c.value,v=this.getGridPosition(f.point,this._terrain.geometry.boundingBox),p=this.getEntityAt(v.x,v.y);p instanceof g.a?(this.player.setTarget(p),this.player.follow(p)):this.player.go(v.x,v.y)}}catch(t){u=!0,l=t}finally{try{!h&&d.return&&d.return()}finally{if(u)throw l}}}},{key:"forEachEntity",value:function(t){n.each(this.entities,function(i){t(i)})}},{key:"findPath",value:function(t,i,e){return this.map.isColliding(i,e)?[]:this.pathfinder&&t?this.pathfinder.findPath(this.map.grid,t,i,e,!1):[]}}]),i}();i.a=m}).call(i,e("Ml+6"),e("rdLu"))},cbRa:function(t,i,e){"use strict";var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s),o=function(){function t(){a()(this,t)}return r()(t,[{key:"setGame",value:function(t){this.game=t}},{key:"center",value:function(){window.scrollTo(0,1)}},{key:"start",value:function(t){this.center(),this.game.run()}}]),t}();i.a=o},fzpQ:function(t,i,e){"use strict";var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s),o=e("zTqn"),h=e("yh7f"),u=function(){function t(i){a()(this,t),this.game=i}return r()(t,[{key:"update",value:function(){this.updateCharacters(),this.updateTransitions()}},{key:"updateCharacters",value:function(){var t=this;this.game.forEachEntity(function(i){i instanceof o.a&&i.isLoaded&&t.updateCharacter(i)})}},{key:"updateCharacter",value:function(t){var i=Math.round(16/Math.round(t.moveSpeed/(1e3/60)));t.isMoving()&&!1===t.movement.inProgress&&(t.orientation===h.a.Orientations.LEFT?t.movement.start(this.game.currentTime,function(i){t.x=i,t.hasMoved()},function(){t.x=t.movement.endValue,t.hasMoved(),t.nextStep()},t.x-i,t.x-16,t.moveSpeed):t.orientation===h.a.Orientations.RIGHT?t.movement.start(this.game.currentTime,function(i){t.x=i,t.hasMoved()},function(){t.x=t.movement.endValue,t.hasMoved(),t.nextStep()},t.x+i,t.x+16,t.moveSpeed):t.orientation===h.a.Orientations.UP?t.movement.start(this.game.currentTime,function(i){t.y=i,t.hasMoved()},function(){t.y=t.movement.endValue,t.hasMoved(),t.nextStep()},t.y-i,t.y-16,t.moveSpeed):t.orientation===h.a.Orientations.DOWN&&t.movement.start(this.game.currentTime,function(i){t.y=i,t.hasMoved()},function(){t.y=t.movement.endValue,t.hasMoved(),t.nextStep()},t.y+i,t.y+16,t.moveSpeed))}},{key:"updateTransitions",value:function(){var t=this,i=this.game.map.offset.x+this.game.map.tilesize/2,e=this.game.map.offset.y+this.game.map.tilesize/2;this.game.forEachEntity(function(n){var a=n.movement;a&&a.inProgress&&a.step(t.game.currentTime),n.mesh&&n.mesh.position.set(i+n.x+n.offset.x,0+n.offset.y,e+n.y+n.offset.z)})}}]),t}();i.a=u},m3jU:function(t,i,e){"use strict";var n=e("Zrlr"),a=e.n(n),s=e("wxAW"),r=e.n(s),o=function(){function t(i,e){a()(this,t),this.id=i,this.kind=e,this.isLoaded=!1}return r()(t,[{key:"setGridSize",value:function(t){this.gridSize=t}},{key:"setPosition",value:function(t,i){this.x=t,this.y=i}},{key:"setGridPosition",value:function(t,i){this.gridX=t,this.gridY=i,this.setPosition(t*this.gridSize,i*this.gridSize)}}]),t}();i.a=o},wV90:function(t,i,e){"use strict";var n=new Int32Array(4096);i.a={build:function(t,i,e){for(var a=[i[0]-t[0],i[1]-t[1],i[2]-t[2]],s=new Array(a[2]*a[1]*a[0]),r=0,o=t[2];o<i[2];o++)for(var h=t[1];h<i[1];h++)for(var u=t[0];u<i[0];u++)s[r]=e(u,h,o),r++;return function(t,i){for(var e=[],a=[],s=i[0],r=s*i[1],o=0;o<3;++o){var h,u,l,c,d,f,v,p,y,g,m,k,w=(o+1)%3,x=(o+2)%3,P=[0,0,0],b=[0,0,0],_=[0,0,0],M=[0,0,0],S=i[o],G=i[w],E=i[x];for(n.length<G*E&&(n=new Int32Array(G*E)),b[o]=1,P[o]=-1,g=s*b[1],m=r*b[2];P[o]<S;){for(k=P[o],p=0,P[x]=0;P[x]<E;++P[x])for(P[w]=0;P[w]<G;++P[w],++p){var T=k>=0&&t[P[0]+s*P[1]+r*P[2]],O=k<S-1&&t[P[0]+b[0]+s*P[1]+g+r*P[2]+m];n[p]=(T?!O:O)?T||-O:0}for(++P[o],p=0,u=0;u<E;++u)for(h=0;h<G;)if(y=n[p]){for(d=1;y===n[p+d]&&h+d<G;)d++;for(v=1;u+v<E;++v){for(l=0;l<d&&y===n[p+l+v*G];)l++;if(l<d)break}_[o]=0,M[o]=0,P[w]=h,P[x]=u,y>0?(M[x]=v,M[w]=0,_[w]=d,_[x]=0):(y=-y,_[x]=v,_[w]=0,M[w]=d,M[x]=0);var z=e.length;for(e.push([P[0],P[1],P[2]]),e.push([P[0]+_[0],P[1]+_[1],P[2]+_[2]]),e.push([P[0]+_[0]+M[0],P[1]+_[1]+M[1],P[2]+_[2]+M[2]]),e.push([P[0]+M[0],P[1]+M[1],P[2]+M[2]]),a.push([z,z+1,z+2,z+3,y]),f=p+d,c=0;c<v;++c)for(l=p;l<f;++l)n[l+c*G]=0;h+=d,p+=d}else h++,p++}}return{vertices:e,faces:a}}(s,a)}}},yh7f:function(t,i,e){"use strict";i.a={Orientations:{UP:1,DOWN:2,LEFT:3,RIGHT:4},Entities:{PLAYER:1,FIRE:2,CHEST:3}}},zTqn:function(t,i,e){"use strict";(function(t){var n=e("Zx67"),a=e.n(n),s=e("Zrlr"),r=e.n(s),o=e("wxAW"),h=e.n(o),u=e("zwoO"),l=e.n(u),c=e("Pf15"),d=e.n(c),f=e("wV90"),v=e("m3jU"),p=e("TAbc"),y=e("yh7f"),g=function(i){function e(t,i){r()(this,e);var n=l()(this,(e.__proto__||a()(e)).call(this,t,i));return n.nextGridX=-1,n.nextGridY=-1,n.orientation=y.a.Orientations.DOWN,n.movement=new p.a,n.path=null,n.newDestination=null,n.adjacentTiles={},n.moveSpeed=120,n.walkSpeed=100,n.idleSpeed=450,n}return d()(e,i),h()(e,[{key:"setSprite",value:function(t){this.sprite=t,this.buildMesh(),this.isLoaded=!0}},{key:"getFramePixelData",value:function(){var t=document.createElement("canvas");t.width=this.sprite.width,t.height=this.sprite.height;var i=t.getContext("2d");i.translate(0,this.sprite.height),i.scale(1,-1),i.drawImage(this.sprite,0,0);return i.getImageData(0,0,32,32)}},{key:"buildMesh",value:function(){if(this.sprite){for(var i=this.getFramePixelData(),e=f.a.build([0,0,0],[i.width,i.height,1],function(t,e,n){var a=4*(t+e*i.width),s=i.data[a+0],r=i.data[a+1],o=i.data[a+2];return 255===i.data[a+3]?(s<<16)+(r<<8)+o:0}),n=new t.Geometry,a=0;a<e.vertices.length;++a){var s=e.vertices[a];n.vertices.push(new t.Vector3(s[0],s[1],s[2]))}for(var r=0;r<e.faces.length;++r){var o=e.faces[r],h=new t.Color(o[4]),u=new t.Face3(o[0],o[1],o[2]);u.color=h,u.vertexColors=[h,h,h],n.faces.push(u);var l=new t.Face3(o[2],o[3],o[0]);l.color=h,l.vertexColors=[h,h,h],n.faces.push(l)}n.computeFaceNormals(),n.verticesNeedUpdate=!0,n.elementsNeedUpdate=!0,n.normalsNeedUpdate=!0,n.computeBoundingBox();var c=new t.MeshLambertMaterial({vertexColors:!0}),d=new t.Mesh(n,c);d.doubleSided=!1,d.castShadow=!0;var v=n.boundingBox.min;n.boundingBox.max;this.offset={x:-16,y:-v.y,z:0},this.mesh=d}}},{key:"requestPathfindingTo",value:function(t,i){return this.request_path_callback?this.request_path_callback(t,i):[]}},{key:"onRequestPath",value:function(t){this.request_path_callback=t}},{key:"onStartPathing",value:function(t){this.start_pathing_callback=t}},{key:"onStopPathing",value:function(t){this.stop_pathing_callback=t}},{key:"onBeforeStep",value:function(t){this.before_step_callback=t}},{key:"onStep",value:function(t){this.step_callback=t}},{key:"isMoving",value:function(){return!(null===this.path)}},{key:"hasMoved",value:function(){this.hasmoved_callback&&this.hasmoved_callback(this)}},{key:"hasNextStep",value:function(){return this.path.length-1>this.step}},{key:"hasChangedItsPath",value:function(){return!(null===this.newDestination)}},{key:"setOrientation",value:function(t){t&&(this.orientation=t)}},{key:"idle",value:function(t){this.setOrientation(t)}},{key:"walk",value:function(t){this.setOrientation(t)}},{key:"go",value:function(t,i){this.followingMode&&(this.followingMode=!1,this.target=null),this.moveTo(t,i)}},{key:"follow",value:function(t){t&&(this.followingMode=!0,this.moveTo(t.gridX,t.gridY))}},{key:"moveTo",value:function(t,i){if(this.destination={gridX:t,gridY:i},this.isMoving())this.continueTo(t,i);else{var e=this.requestPathfindingTo(t,i);this.followPath(e)}}},{key:"stop",value:function(){this.isMoving()&&(this.interrupted=!0)}},{key:"continueTo",value:function(t,i){this.newDestination={x:t,y:i}}},{key:"updateMovement",value:function(){var t=this.path,i=this.step;t[i][0]<t[i-1][0]&&this.walk(y.a.Orientations.LEFT),t[i][0]>t[i-1][0]&&this.walk(y.a.Orientations.RIGHT),t[i][1]<t[i-1][1]&&this.walk(y.a.Orientations.UP),t[i][1]>t[i-1][1]&&this.walk(y.a.Orientations.DOWN)}},{key:"followPath",value:function(t){t.length>1&&(this.path=t,this.step=0,this.followingMode&&t.pop(),this.start_pathing_callback&&this.start_pathing_callback(t),this.nextStep())}},{key:"nextStep",value:function(){var t=!1;if(this.isMoving()){if(this.before_step_callback&&this.before_step_callback(),this.updatePositionOnGrid(),this.interrupted)t=!0,this.interrupted=!1;else if(this.hasNextStep()&&(this.nextGridX=this.path[this.step+1][0],this.nextGridY=this.path[this.step+1][1]),this.step_callback&&this.step_callback(),this.hasChangedItsPath()){var i=this.newDestination.x,e=this.newDestination.y,n=this.requestPathfindingTo(i,e);this.newDestination=null,n.length<2?t=!0:this.followPath(n)}else this.hasNextStep()?(this.step+=1,this.updateMovement()):t=!0;t&&(this.path=null,this.idle(),this.stop_pathing_callback&&this.stop_pathing_callback(this.gridX,this.gridY))}}},{key:"updatePositionOnGrid",value:function(){this.setGridPosition(this.path[this.step][0],this.path[this.step][1])}},{key:"setTarget",value:function(t){this.target!==t&&(this.target=t)}}]),e}(v.a);i.a=g}).call(i,e("Ml+6"))}},["NHnr"]);
//# sourceMappingURL=app.0b56bd37f7f838cb2e0e.js.map